var fr=Object.defineProperty;var ur=(E,l,f)=>l in E?fr(E,l,{enumerable:!0,configurable:!0,writable:!0,value:f}):E[l]=f;var T=(E,l,f)=>ur(E,typeof l!="symbol"?l+"":l,f);class dr{constructor(l,f){T(this,"baseUrl");T(this,"nonce");this.baseUrl=l.replace(/\/$/,""),this.nonce=f}async request(l,f={}){const o=await fetch(`${this.baseUrl}/${l.replace(/^\//,"")}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":this.nonce,...f.headers||{}},credentials:"same-origin",...f});if(!o.ok){const p=await o.text();throw new Error(p||"è¯·æ±‚å¤±è´¥")}return o.status===204?{}:await o.json()}fetchConfig(){return this.request("/config")}saveConfig(l){return this.request("/config",{method:"POST",body:JSON.stringify({content:l})})}fetchModel(){return this.request("/model")}saveModel(l){return this.request("/model",{method:"POST",body:JSON.stringify({content:l})})}saveApiKey(l){return this.request("/key",{method:"POST",body:JSON.stringify({api_key:l})})}fetchVps(){return this.request("/vps")}fetchCachedVps(){return this.request("/vps/cached")}validateVps(l,f){return this.request("/vps/validate",{method:"POST",body:JSON.stringify({vendor:l,pid:f})})}refreshPromo(l,f){return this.request("/vps/promo",{method:"POST",body:JSON.stringify({vendor:l,pid:f})})}savePromo(l,f,o){return this.request("/vps/promo",{method:"POST",body:JSON.stringify({vendor:l,pid:f,content:o})})}refreshMeta(l,f){return this.request("/vps/meta",{method:"POST",body:JSON.stringify({vendor:l,pid:f})})}saveMeta(l,f,o){return this.request("/vps/meta",{method:"POST",body:JSON.stringify({vendor:l,pid:f,content:o})})}runDiagnostics(){return this.request("/diagnostics",{method:"POST"})}saveTimezone(l){return this.request("/timezone",{method:"POST",body:JSON.stringify({timezone:l})})}fetchExtraCss(){return this.request("/design")}saveExtraCss(l){return this.request("/design",{method:"POST",body:JSON.stringify({extra_css:l})})}fetchLogs(){return this.request("/logs")}appendLog(l,f="info"){return this.request("/logs",{method:"POST",body:JSON.stringify({message:l,level:f})})}}function hr(E){return E&&E.__esModule&&Object.prototype.hasOwnProperty.call(E,"default")?E.default:E}var pr=function(){function E(o,p){function s(){this.constructor=o}s.prototype=p.prototype,o.prototype=new s}function l(o,p,s,C,y,w){this.message=o,this.expected=p,this.found=s,this.offset=C,this.line=y,this.column=w,this.name="SyntaxError"}E(l,Error);function f(o){var p=arguments.length>1?arguments[1]:{},s={},C={start:dt},y=dt,w=function(){return Nt},n=s,L="#",j={type:"literal",value:"#",description:'"#"'},O=void 0,H={type:"any",description:"any character"},z="[",W={type:"literal",value:"[",description:'"["'},J="]",P={type:"literal",value:"]",description:'"]"'},A=function(e){Ve(q("ObjectPath",e,I,R))},_=function(e){Ve(q("ArrayPath",e,I,R))},S=function(e,r){return e.concat(r)},U=function(e){return[e]},F=function(e){return e},K=".",D={type:"literal",value:".",description:'"."'},ee="=",te={type:"literal",value:"=",description:'"="'},qe=function(e,r){Ve(q("Assign",r,I,R,e))},Ot=function(e){return e.join("")},je=function(e){return e.value},ae='"""',xe={type:"literal",value:'"""',description:'"\\"\\"\\""'},re=null,ge=function(e){return q("String",e.join(""),I,R)},Pe='"',be={type:"literal",value:'"',description:'"\\""'},ie="'''",we={type:"literal",value:"'''",description:`"'''"`},Ae="'",Ee={type:"literal",value:"'",description:`"'"`},_e=function(e){return e},Dt=function(e){return e},Ft="\\",It={type:"literal",value:"\\",description:'"\\\\"'},Rt=function(){return""},qt="e",jt={type:"literal",value:"e",description:'"e"'},zt="E",Ut={type:"literal",value:"E",description:'"E"'},Ht=function(e,r){return q("Float",parseFloat(e+"e"+r),I,R)},Jt=function(e){return q("Float",parseFloat(e),I,R)},Se="+",ke={type:"literal",value:"+",description:'"+"'},ze=function(e){return e.join("")},le="-",ce={type:"literal",value:"-",description:'"-"'},Ue=function(e){return"-"+e.join("")},Kt=function(e){return q("Integer",parseInt(e,10),I,R)},He="true",Zt={type:"literal",value:"true",description:'"true"'},Yt=function(){return q("Boolean",!0,I,R)},Je="false",Wt={type:"literal",value:"false",description:'"false"'},Gt=function(){return q("Boolean",!1,I,R)},Xt=function(){return q("Array",[],I,R)},Qt=function(e){return q("Array",e?[e]:[],I,R)},es=function(e){return q("Array",e,I,R)},ts=function(e,r){return q("Array",e.concat(r),I,R)},Ke=function(e){return e},Ze=",",Ye={type:"literal",value:",",description:'","'},ss="{",rs={type:"literal",value:"{",description:'"{"'},as="}",is={type:"literal",value:"}",description:'"}"'},ns=function(e){return q("InlineTable",e,I,R)},We=function(e,r){return q("InlineTableValue",r,I,R,e)},os=function(e){return"."+e},ls=function(e){return e.join("")},fe=":",ue={type:"literal",value:":",description:'":"'},Ge=function(e){return e.join("")},Xe="T",Qe={type:"literal",value:"T",description:'"T"'},cs="Z",fs={type:"literal",value:"Z",description:'"Z"'},us=function(e,r){return q("Date",new Date(e+"T"+r+"Z"),I,R)},ds=function(e,r){return q("Date",new Date(e+"T"+r),I,R)},hs=/^[ \t]/,ps={type:"class",value:"[ \\t]",description:"[ \\t]"},et=`
`,tt={type:"literal",value:`
`,description:'"\\n"'},gs="\r",ms={type:"literal",value:"\r",description:'"\\r"'},vs=/^[0-9a-f]/i,ys={type:"class",value:"[0-9a-f]i",description:"[0-9a-f]i"},$s=/^[0-9]/,Cs={type:"class",value:"[0-9]",description:"[0-9]"},xs="_",Ps={type:"literal",value:"_",description:'"_"'},bs=function(){return""},ws=/^[A-Za-z0-9_\-]/,As={type:"class",value:"[A-Za-z0-9_\\-]",description:"[A-Za-z0-9_\\-]"},Es=function(e){return e.join("")},st='\\"',_s={type:"literal",value:'\\"',description:'"\\\\\\""'},Ss=function(){return'"'},rt="\\\\",ks={type:"literal",value:"\\\\",description:'"\\\\\\\\"'},Ms=function(){return"\\"},at="\\b",Ns={type:"literal",value:"\\b",description:'"\\\\b"'},Ts=function(){return"\b"},it="\\t",Ls={type:"literal",value:"\\t",description:'"\\\\t"'},Bs=function(){return"	"},nt="\\n",Vs={type:"literal",value:"\\n",description:'"\\\\n"'},Os=function(){return`
`},ot="\\f",Ds={type:"literal",value:"\\f",description:'"\\\\f"'},Fs=function(){return"\f"},lt="\\r",Is={type:"literal",value:"\\r",description:'"\\\\r"'},Rs=function(){return"\r"},ct="\\U",qs={type:"literal",value:"\\U",description:'"\\\\U"'},ft=function(e){return lr(e.join(""))},ut="\\u",js={type:"literal",value:"\\u",description:'"\\\\u"'},t=0,x=0,de=0,Me={line:1,column:1,seenCR:!1},me=0,Ne=[],h=0,g={},ve;if("startRule"in p){if(!(p.startRule in C))throw new Error(`Can't start parsing from rule "`+p.startRule+'".');y=C[p.startRule]}function I(){return Te(x).line}function R(){return Te(x).column}function Te(e){function r(a,i,c){var u,d;for(u=i;u<c;u++)d=o.charAt(u),d===`
`?(a.seenCR||a.line++,a.column=1,a.seenCR=!1):d==="\r"||d==="\u2028"||d==="\u2029"?(a.line++,a.column=1,a.seenCR=!0):(a.column++,a.seenCR=!1)}return de!==e&&(de>e&&(de=0,Me={line:1,column:1,seenCR:!1}),r(Me,de,e),de=e),Me}function m(e){t<me||(t>me&&(me=t,Ne=[]),Ne.push(e))}function zs(e,r,a){function i(v){var b=1;for(v.sort(function(N,k){return N.description<k.description?-1:N.description>k.description?1:0});b<v.length;)v[b-1]===v[b]?v.splice(b,1):b++}function c(v,b){function N(oe){function se(Y){return Y.charCodeAt(0).toString(16).toUpperCase()}return oe.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(Y){return"\\x0"+se(Y)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(Y){return"\\x"+se(Y)}).replace(/[\u0180-\u0FFF]/g,function(Y){return"\\u0"+se(Y)}).replace(/[\u1080-\uFFFF]/g,function(Y){return"\\u"+se(Y)})}var k=new Array(v.length),B,V,Z;for(Z=0;Z<v.length;Z++)k[Z]=v[Z].description;return B=v.length>1?k.slice(0,-1).join(", ")+" or "+k[v.length-1]:k[0],V=b?'"'+N(b)+'"':"end of input","Expected "+B+" but "+V+" found."}var u=Te(a),d=a<o.length?o.charAt(a):null;return r!==null&&i(r),new l(c(r,d),r,d,a,u.line,u.column)}function dt(){var e,r,a,i=t*49+0,c=g[i];if(c)return t=c.nextPos,c.result;for(e=t,r=[],a=ht();a!==s;)r.push(a),a=ht();return r!==s&&(x=e,r=w()),e=r,g[i]={nextPos:t,result:e},e}function ht(){var e,r,a,i,c,u,d,v=t*49+1,b=g[v];if(b)return t=b.nextPos,b.result;for(e=t,r=[],a=$();a!==s;)r.push(a),a=$();if(r!==s)if(a=Us(),a!==s){for(i=[],c=$();c!==s;)i.push(c),c=$();if(i!==s){for(c=[],u=ye();u!==s;)c.push(u),u=ye();if(c!==s){if(u=[],d=X(),d!==s)for(;d!==s;)u.push(d),d=X();else u=n;u===s&&(u=Ce()),u!==s?(r=[r,a,i,c,u],e=r):(t=e,e=n)}else t=e,e=n}else t=e,e=n}else t=e,e=n;else t=e,e=n;if(e===s){if(e=t,r=[],a=$(),a!==s)for(;a!==s;)r.push(a),a=$();else r=n;if(r!==s){if(a=[],i=X(),i!==s)for(;i!==s;)a.push(i),i=X();else a=n;a===s&&(a=Ce()),a!==s?(r=[r,a],e=r):(t=e,e=n)}else t=e,e=n;e===s&&(e=X())}return g[v]={nextPos:t,result:e},e}function Us(){var e,r=t*49+2,a=g[r];return a?(t=a.nextPos,a.result):(e=ye(),e===s&&(e=Hs(),e===s&&(e=Js(),e===s&&(e=Ks()))),g[r]={nextPos:t,result:e},e)}function ye(){var e,r,a,i,c,u,d=t*49+3,v=g[d];if(v)return t=v.nextPos,v.result;if(e=t,o.charCodeAt(t)===35?(r=L,t++):(r=s,h===0&&m(j)),r!==s){for(a=[],i=t,c=t,h++,u=X(),u===s&&(u=Ce()),h--,u===s?c=O:(t=c,c=n),c!==s?(o.length>t?(u=o.charAt(t),t++):(u=s,h===0&&m(H)),u!==s?(c=[c,u],i=c):(t=i,i=n)):(t=i,i=n);i!==s;)a.push(i),i=t,c=t,h++,u=X(),u===s&&(u=Ce()),h--,u===s?c=O:(t=c,c=n),c!==s?(o.length>t?(u=o.charAt(t),t++):(u=s,h===0&&m(H)),u!==s?(c=[c,u],i=c):(t=i,i=n)):(t=i,i=n);a!==s?(r=[r,a],e=r):(t=e,e=n)}else t=e,e=n;return g[d]={nextPos:t,result:e},e}function Hs(){var e,r,a,i,c,u,d=t*49+4,v=g[d];if(v)return t=v.nextPos,v.result;if(e=t,o.charCodeAt(t)===91?(r=z,t++):(r=s,h===0&&m(W)),r!==s){for(a=[],i=$();i!==s;)a.push(i),i=$();if(a!==s)if(i=pt(),i!==s){for(c=[],u=$();u!==s;)c.push(u),u=$();c!==s?(o.charCodeAt(t)===93?(u=J,t++):(u=s,h===0&&m(P)),u!==s?(x=e,r=A(i),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;return g[d]={nextPos:t,result:e},e}function Js(){var e,r,a,i,c,u,d,v,b=t*49+5,N=g[b];if(N)return t=N.nextPos,N.result;if(e=t,o.charCodeAt(t)===91?(r=z,t++):(r=s,h===0&&m(W)),r!==s)if(o.charCodeAt(t)===91?(a=z,t++):(a=s,h===0&&m(W)),a!==s){for(i=[],c=$();c!==s;)i.push(c),c=$();if(i!==s)if(c=pt(),c!==s){for(u=[],d=$();d!==s;)u.push(d),d=$();u!==s?(o.charCodeAt(t)===93?(d=J,t++):(d=s,h===0&&m(P)),d!==s?(o.charCodeAt(t)===93?(v=J,t++):(v=s,h===0&&m(P)),v!==s?(x=e,r=_(c),e=r):(t=e,e=n)):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n;return g[b]={nextPos:t,result:e},e}function pt(){var e,r,a,i=t*49+6,c=g[i];if(c)return t=c.nextPos,c.result;if(e=t,r=[],a=mt(),a!==s)for(;a!==s;)r.push(a),a=mt();else r=n;return r!==s?(a=gt(),a!==s?(x=e,r=S(r,a),e=r):(t=e,e=n)):(t=e,e=n),e===s&&(e=t,r=gt(),r!==s&&(x=e,r=U(r)),e=r),g[i]={nextPos:t,result:e},e}function gt(){var e,r,a,i,c,u=t*49+7,d=g[u];if(d)return t=d.nextPos,d.result;for(e=t,r=[],a=$();a!==s;)r.push(a),a=$();if(r!==s)if(a=he(),a!==s){for(i=[],c=$();c!==s;)i.push(c),c=$();i!==s?(x=e,r=F(a),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n;if(e===s){for(e=t,r=[],a=$();a!==s;)r.push(a),a=$();if(r!==s)if(a=Le(),a!==s){for(i=[],c=$();c!==s;)i.push(c),c=$();i!==s?(x=e,r=F(a),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n}return g[u]={nextPos:t,result:e},e}function mt(){var e,r,a,i,c,u,d,v=t*49+8,b=g[v];if(b)return t=b.nextPos,b.result;for(e=t,r=[],a=$();a!==s;)r.push(a),a=$();if(r!==s)if(a=he(),a!==s){for(i=[],c=$();c!==s;)i.push(c),c=$();if(i!==s)if(o.charCodeAt(t)===46?(c=K,t++):(c=s,h===0&&m(D)),c!==s){for(u=[],d=$();d!==s;)u.push(d),d=$();u!==s?(x=e,r=F(a),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n;if(e===s){for(e=t,r=[],a=$();a!==s;)r.push(a),a=$();if(r!==s)if(a=Le(),a!==s){for(i=[],c=$();c!==s;)i.push(c),c=$();if(i!==s)if(o.charCodeAt(t)===46?(c=K,t++):(c=s,h===0&&m(D)),c!==s){for(u=[],d=$();d!==s;)u.push(d),d=$();u!==s?(x=e,r=F(a),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n}return g[v]={nextPos:t,result:e},e}function Ks(){var e,r,a,i,c,u,d=t*49+9,v=g[d];if(v)return t=v.nextPos,v.result;if(e=t,r=he(),r!==s){for(a=[],i=$();i!==s;)a.push(i),i=$();if(a!==s)if(o.charCodeAt(t)===61?(i=ee,t++):(i=s,h===0&&m(te)),i!==s){for(c=[],u=$();u!==s;)c.push(u),u=$();c!==s?(u=ne(),u!==s?(x=e,r=qe(r,u),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;if(e===s)if(e=t,r=Le(),r!==s){for(a=[],i=$();i!==s;)a.push(i),i=$();if(a!==s)if(o.charCodeAt(t)===61?(i=ee,t++):(i=s,h===0&&m(te)),i!==s){for(c=[],u=$();u!==s;)c.push(u),u=$();c!==s?(u=ne(),u!==s?(x=e,r=qe(r,u),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;return g[d]={nextPos:t,result:e},e}function he(){var e,r,a,i=t*49+10,c=g[i];if(c)return t=c.nextPos,c.result;if(e=t,r=[],a=kt(),a!==s)for(;a!==s;)r.push(a),a=kt();else r=n;return r!==s&&(x=e,r=Ot(r)),e=r,g[i]={nextPos:t,result:e},e}function Le(){var e,r,a=t*49+11,i=g[a];return i?(t=i.nextPos,i.result):(e=t,r=vt(),r!==s&&(x=e,r=je(r)),e=r,e===s&&(e=t,r=yt(),r!==s&&(x=e,r=je(r)),e=r),g[a]={nextPos:t,result:e},e)}function ne(){var e,r=t*49+12,a=g[r];return a?(t=a.nextPos,a.result):(e=Zs(),e===s&&(e=ir(),e===s&&(e=Xs(),e===s&&(e=Qs(),e===s&&(e=er(),e===s&&(e=tr(),e===s&&(e=sr())))))),g[r]={nextPos:t,result:e},e)}function Zs(){var e,r=t*49+13,a=g[r];return a?(t=a.nextPos,a.result):(e=Ys(),e===s&&(e=vt(),e===s&&(e=Ws(),e===s&&(e=yt()))),g[r]={nextPos:t,result:e},e)}function Ys(){var e,r,a,i,c,u=t*49+14,d=g[u];if(d)return t=d.nextPos,d.result;if(e=t,o.substr(t,3)===ae?(r=ae,t+=3):(r=s,h===0&&m(xe)),r!==s)if(a=X(),a===s&&(a=re),a!==s){for(i=[],c=xt();c!==s;)i.push(c),c=xt();i!==s?(o.substr(t,3)===ae?(c=ae,t+=3):(c=s,h===0&&m(xe)),c!==s?(x=e,r=ge(i),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;else t=e,e=n;return g[u]={nextPos:t,result:e},e}function vt(){var e,r,a,i,c=t*49+15,u=g[c];if(u)return t=u.nextPos,u.result;if(e=t,o.charCodeAt(t)===34?(r=Pe,t++):(r=s,h===0&&m(be)),r!==s){for(a=[],i=$t();i!==s;)a.push(i),i=$t();a!==s?(o.charCodeAt(t)===34?(i=Pe,t++):(i=s,h===0&&m(be)),i!==s?(x=e,r=ge(a),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;return g[c]={nextPos:t,result:e},e}function Ws(){var e,r,a,i,c,u=t*49+16,d=g[u];if(d)return t=d.nextPos,d.result;if(e=t,o.substr(t,3)===ie?(r=ie,t+=3):(r=s,h===0&&m(we)),r!==s)if(a=X(),a===s&&(a=re),a!==s){for(i=[],c=Pt();c!==s;)i.push(c),c=Pt();i!==s?(o.substr(t,3)===ie?(c=ie,t+=3):(c=s,h===0&&m(we)),c!==s?(x=e,r=ge(i),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;else t=e,e=n;return g[u]={nextPos:t,result:e},e}function yt(){var e,r,a,i,c=t*49+17,u=g[c];if(u)return t=u.nextPos,u.result;if(e=t,o.charCodeAt(t)===39?(r=Ae,t++):(r=s,h===0&&m(Ee)),r!==s){for(a=[],i=Ct();i!==s;)a.push(i),i=Ct();a!==s?(o.charCodeAt(t)===39?(i=Ae,t++):(i=s,h===0&&m(Ee)),i!==s?(x=e,r=ge(a),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;return g[c]={nextPos:t,result:e},e}function $t(){var e,r,a,i=t*49+18,c=g[i];return c?(t=c.nextPos,c.result):(e=Mt(),e===s&&(e=t,r=t,h++,o.charCodeAt(t)===34?(a=Pe,t++):(a=s,h===0&&m(be)),h--,a===s?r=O:(t=r,r=n),r!==s?(o.length>t?(a=o.charAt(t),t++):(a=s,h===0&&m(H)),a!==s?(x=e,r=_e(a),e=r):(t=e,e=n)):(t=e,e=n)),g[i]={nextPos:t,result:e},e)}function Ct(){var e,r,a,i=t*49+19,c=g[i];return c?(t=c.nextPos,c.result):(e=t,r=t,h++,o.charCodeAt(t)===39?(a=Ae,t++):(a=s,h===0&&m(Ee)),h--,a===s?r=O:(t=r,r=n),r!==s?(o.length>t?(a=o.charAt(t),t++):(a=s,h===0&&m(H)),a!==s?(x=e,r=_e(a),e=r):(t=e,e=n)):(t=e,e=n),g[i]={nextPos:t,result:e},e)}function xt(){var e,r,a,i=t*49+20,c=g[i];return c?(t=c.nextPos,c.result):(e=Mt(),e===s&&(e=Gs(),e===s&&(e=t,r=t,h++,o.substr(t,3)===ae?(a=ae,t+=3):(a=s,h===0&&m(xe)),h--,a===s?r=O:(t=r,r=n),r!==s?(o.length>t?(a=o.charAt(t),t++):(a=s,h===0&&m(H)),a!==s?(x=e,r=Dt(a),e=r):(t=e,e=n)):(t=e,e=n))),g[i]={nextPos:t,result:e},e)}function Gs(){var e,r,a,i,c,u=t*49+21,d=g[u];if(d)return t=d.nextPos,d.result;if(e=t,o.charCodeAt(t)===92?(r=Ft,t++):(r=s,h===0&&m(It)),r!==s)if(a=X(),a!==s){for(i=[],c=St();c!==s;)i.push(c),c=St();i!==s?(x=e,r=Rt(),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n;return g[u]={nextPos:t,result:e},e}function Pt(){var e,r,a,i=t*49+22,c=g[i];return c?(t=c.nextPos,c.result):(e=t,r=t,h++,o.substr(t,3)===ie?(a=ie,t+=3):(a=s,h===0&&m(we)),h--,a===s?r=O:(t=r,r=n),r!==s?(o.length>t?(a=o.charAt(t),t++):(a=s,h===0&&m(H)),a!==s?(x=e,r=_e(a),e=r):(t=e,e=n)):(t=e,e=n),g[i]={nextPos:t,result:e},e)}function Xs(){var e,r,a,i,c=t*49+23,u=g[c];return u?(t=u.nextPos,u.result):(e=t,r=bt(),r===s&&(r=Be()),r!==s?(o.charCodeAt(t)===101?(a=qt,t++):(a=s,h===0&&m(jt)),a===s&&(o.charCodeAt(t)===69?(a=zt,t++):(a=s,h===0&&m(Ut))),a!==s?(i=Be(),i!==s?(x=e,r=Ht(r,i),e=r):(t=e,e=n)):(t=e,e=n)):(t=e,e=n),e===s&&(e=t,r=bt(),r!==s&&(x=e,r=Jt(r)),e=r),g[c]={nextPos:t,result:e},e)}function bt(){var e,r,a,i,c,u,d=t*49+24,v=g[d];return v?(t=v.nextPos,v.result):(e=t,o.charCodeAt(t)===43?(r=Se,t++):(r=s,h===0&&m(ke)),r===s&&(r=re),r!==s?(a=t,i=pe(),i!==s?(o.charCodeAt(t)===46?(c=K,t++):(c=s,h===0&&m(D)),c!==s?(u=pe(),u!==s?(i=[i,c,u],a=i):(t=a,a=n)):(t=a,a=n)):(t=a,a=n),a!==s?(x=e,r=ze(a),e=r):(t=e,e=n)):(t=e,e=n),e===s&&(e=t,o.charCodeAt(t)===45?(r=le,t++):(r=s,h===0&&m(ce)),r!==s?(a=t,i=pe(),i!==s?(o.charCodeAt(t)===46?(c=K,t++):(c=s,h===0&&m(D)),c!==s?(u=pe(),u!==s?(i=[i,c,u],a=i):(t=a,a=n)):(t=a,a=n)):(t=a,a=n),a!==s?(x=e,r=Ue(a),e=r):(t=e,e=n)):(t=e,e=n)),g[d]={nextPos:t,result:e},e)}function Qs(){var e,r,a=t*49+25,i=g[a];return i?(t=i.nextPos,i.result):(e=t,r=Be(),r!==s&&(x=e,r=Kt(r)),e=r,g[a]={nextPos:t,result:e},e)}function Be(){var e,r,a,i,c,u=t*49+26,d=g[u];if(d)return t=d.nextPos,d.result;if(e=t,o.charCodeAt(t)===43?(r=Se,t++):(r=s,h===0&&m(ke)),r===s&&(r=re),r!==s){if(a=[],i=M(),i!==s)for(;i!==s;)a.push(i),i=M();else a=n;a!==s?(i=t,h++,o.charCodeAt(t)===46?(c=K,t++):(c=s,h===0&&m(D)),h--,c===s?i=O:(t=i,i=n),i!==s?(x=e,r=ze(a),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;if(e===s)if(e=t,o.charCodeAt(t)===45?(r=le,t++):(r=s,h===0&&m(ce)),r!==s){if(a=[],i=M(),i!==s)for(;i!==s;)a.push(i),i=M();else a=n;a!==s?(i=t,h++,o.charCodeAt(t)===46?(c=K,t++):(c=s,h===0&&m(D)),h--,c===s?i=O:(t=i,i=n),i!==s?(x=e,r=Ue(a),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;return g[u]={nextPos:t,result:e},e}function er(){var e,r,a=t*49+27,i=g[a];return i?(t=i.nextPos,i.result):(e=t,o.substr(t,4)===He?(r=He,t+=4):(r=s,h===0&&m(Zt)),r!==s&&(x=e,r=Yt()),e=r,e===s&&(e=t,o.substr(t,5)===Je?(r=Je,t+=5):(r=s,h===0&&m(Wt)),r!==s&&(x=e,r=Gt()),e=r),g[a]={nextPos:t,result:e},e)}function tr(){var e,r,a,i,c,u=t*49+28,d=g[u];if(d)return t=d.nextPos,d.result;if(e=t,o.charCodeAt(t)===91?(r=z,t++):(r=s,h===0&&m(W)),r!==s){for(a=[],i=G();i!==s;)a.push(i),i=G();a!==s?(o.charCodeAt(t)===93?(i=J,t++):(i=s,h===0&&m(P)),i!==s?(x=e,r=Xt(),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;if(e===s&&(e=t,o.charCodeAt(t)===91?(r=z,t++):(r=s,h===0&&m(W)),r!==s?(a=wt(),a===s&&(a=re),a!==s?(o.charCodeAt(t)===93?(i=J,t++):(i=s,h===0&&m(P)),i!==s?(x=e,r=Qt(a),e=r):(t=e,e=n)):(t=e,e=n)):(t=e,e=n),e===s)){if(e=t,o.charCodeAt(t)===91?(r=z,t++):(r=s,h===0&&m(W)),r!==s){if(a=[],i=$e(),i!==s)for(;i!==s;)a.push(i),i=$e();else a=n;a!==s?(o.charCodeAt(t)===93?(i=J,t++):(i=s,h===0&&m(P)),i!==s?(x=e,r=es(a),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;if(e===s)if(e=t,o.charCodeAt(t)===91?(r=z,t++):(r=s,h===0&&m(W)),r!==s){if(a=[],i=$e(),i!==s)for(;i!==s;)a.push(i),i=$e();else a=n;a!==s?(i=wt(),i!==s?(o.charCodeAt(t)===93?(c=J,t++):(c=s,h===0&&m(P)),c!==s?(x=e,r=ts(a,i),e=r):(t=e,e=n)):(t=e,e=n)):(t=e,e=n)}else t=e,e=n}return g[u]={nextPos:t,result:e},e}function wt(){var e,r,a,i,c,u=t*49+29,d=g[u];if(d)return t=d.nextPos,d.result;for(e=t,r=[],a=G();a!==s;)r.push(a),a=G();if(r!==s)if(a=ne(),a!==s){for(i=[],c=G();c!==s;)i.push(c),c=G();i!==s?(x=e,r=Ke(a),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n;return g[u]={nextPos:t,result:e},e}function $e(){var e,r,a,i,c,u,d,v=t*49+30,b=g[v];if(b)return t=b.nextPos,b.result;for(e=t,r=[],a=G();a!==s;)r.push(a),a=G();if(r!==s)if(a=ne(),a!==s){for(i=[],c=G();c!==s;)i.push(c),c=G();if(i!==s)if(o.charCodeAt(t)===44?(c=Ze,t++):(c=s,h===0&&m(Ye)),c!==s){for(u=[],d=G();d!==s;)u.push(d),d=G();u!==s?(x=e,r=Ke(a),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n;return g[v]={nextPos:t,result:e},e}function G(){var e,r=t*49+31,a=g[r];return a?(t=a.nextPos,a.result):(e=$(),e===s&&(e=X(),e===s&&(e=ye())),g[r]={nextPos:t,result:e},e)}function sr(){var e,r,a,i,c,u,d=t*49+32,v=g[d];if(v)return t=v.nextPos,v.result;if(e=t,o.charCodeAt(t)===123?(r=ss,t++):(r=s,h===0&&m(rs)),r!==s){for(a=[],i=$();i!==s;)a.push(i),i=$();if(a!==s){for(i=[],c=At();c!==s;)i.push(c),c=At();if(i!==s){for(c=[],u=$();u!==s;)c.push(u),u=$();c!==s?(o.charCodeAt(t)===125?(u=as,t++):(u=s,h===0&&m(is)),u!==s?(x=e,r=ns(i),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n}else t=e,e=n}else t=e,e=n;return g[d]={nextPos:t,result:e},e}function At(){var e,r,a,i,c,u,d,v,b,N,k,B=t*49+33,V=g[B];if(V)return t=V.nextPos,V.result;for(e=t,r=[],a=$();a!==s;)r.push(a),a=$();if(r!==s)if(a=he(),a!==s){for(i=[],c=$();c!==s;)i.push(c),c=$();if(i!==s)if(o.charCodeAt(t)===61?(c=ee,t++):(c=s,h===0&&m(te)),c!==s){for(u=[],d=$();d!==s;)u.push(d),d=$();if(u!==s)if(d=ne(),d!==s){for(v=[],b=$();b!==s;)v.push(b),b=$();if(v!==s)if(o.charCodeAt(t)===44?(b=Ze,t++):(b=s,h===0&&m(Ye)),b!==s){for(N=[],k=$();k!==s;)N.push(k),k=$();N!==s?(x=e,r=We(a,d),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n;if(e===s){for(e=t,r=[],a=$();a!==s;)r.push(a),a=$();if(r!==s)if(a=he(),a!==s){for(i=[],c=$();c!==s;)i.push(c),c=$();if(i!==s)if(o.charCodeAt(t)===61?(c=ee,t++):(c=s,h===0&&m(te)),c!==s){for(u=[],d=$();d!==s;)u.push(d),d=$();u!==s?(d=ne(),d!==s?(x=e,r=We(a,d),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n}return g[B]={nextPos:t,result:e},e}function Et(){var e,r,a,i=t*49+34,c=g[i];return c?(t=c.nextPos,c.result):(e=t,o.charCodeAt(t)===46?(r=K,t++):(r=s,h===0&&m(D)),r!==s?(a=pe(),a!==s?(x=e,r=os(a),e=r):(t=e,e=n)):(t=e,e=n),g[i]={nextPos:t,result:e},e)}function _t(){var e,r,a,i,c,u,d,v,b,N,k,B,V=t*49+35,Z=g[V];return Z?(t=Z.nextPos,Z.result):(e=t,r=t,a=M(),a!==s?(i=M(),i!==s?(c=M(),c!==s?(u=M(),u!==s?(o.charCodeAt(t)===45?(d=le,t++):(d=s,h===0&&m(ce)),d!==s?(v=M(),v!==s?(b=M(),b!==s?(o.charCodeAt(t)===45?(N=le,t++):(N=s,h===0&&m(ce)),N!==s?(k=M(),k!==s?(B=M(),B!==s?(a=[a,i,c,u,d,v,b,N,k,B],r=a):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n),r!==s&&(x=e,r=ls(r)),e=r,g[V]={nextPos:t,result:e},e)}function rr(){var e,r,a,i,c,u,d,v,b,N,k,B=t*49+36,V=g[B];return V?(t=V.nextPos,V.result):(e=t,r=t,a=M(),a!==s?(i=M(),i!==s?(o.charCodeAt(t)===58?(c=fe,t++):(c=s,h===0&&m(ue)),c!==s?(u=M(),u!==s?(d=M(),d!==s?(o.charCodeAt(t)===58?(v=fe,t++):(v=s,h===0&&m(ue)),v!==s?(b=M(),b!==s?(N=M(),N!==s?(k=Et(),k===s&&(k=re),k!==s?(a=[a,i,c,u,d,v,b,N,k],r=a):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n),r!==s&&(x=e,r=Ge(r)),e=r,g[B]={nextPos:t,result:e},e)}function ar(){var e,r,a,i,c,u,d,v,b,N,k,B,V,Z,oe,se,Y,Tt=t*49+37,Oe=g[Tt];return Oe?(t=Oe.nextPos,Oe.result):(e=t,r=t,a=M(),a!==s?(i=M(),i!==s?(o.charCodeAt(t)===58?(c=fe,t++):(c=s,h===0&&m(ue)),c!==s?(u=M(),u!==s?(d=M(),d!==s?(o.charCodeAt(t)===58?(v=fe,t++):(v=s,h===0&&m(ue)),v!==s?(b=M(),b!==s?(N=M(),N!==s?(k=Et(),k===s&&(k=re),k!==s?(o.charCodeAt(t)===45?(B=le,t++):(B=s,h===0&&m(ce)),B===s&&(o.charCodeAt(t)===43?(B=Se,t++):(B=s,h===0&&m(ke))),B!==s?(V=M(),V!==s?(Z=M(),Z!==s?(o.charCodeAt(t)===58?(oe=fe,t++):(oe=s,h===0&&m(ue)),oe!==s?(se=M(),se!==s?(Y=M(),Y!==s?(a=[a,i,c,u,d,v,b,N,k,B,V,Z,oe,se,Y],r=a):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n),r!==s&&(x=e,r=Ge(r)),e=r,g[Tt]={nextPos:t,result:e},e)}function ir(){var e,r,a,i,c,u=t*49+38,d=g[u];return d?(t=d.nextPos,d.result):(e=t,r=_t(),r!==s?(o.charCodeAt(t)===84?(a=Xe,t++):(a=s,h===0&&m(Qe)),a!==s?(i=rr(),i!==s?(o.charCodeAt(t)===90?(c=cs,t++):(c=s,h===0&&m(fs)),c!==s?(x=e,r=us(r,i),e=r):(t=e,e=n)):(t=e,e=n)):(t=e,e=n)):(t=e,e=n),e===s&&(e=t,r=_t(),r!==s?(o.charCodeAt(t)===84?(a=Xe,t++):(a=s,h===0&&m(Qe)),a!==s?(i=ar(),i!==s?(x=e,r=ds(r,i),e=r):(t=e,e=n)):(t=e,e=n)):(t=e,e=n)),g[u]={nextPos:t,result:e},e)}function $(){var e,r=t*49+39,a=g[r];return a?(t=a.nextPos,a.result):(hs.test(o.charAt(t))?(e=o.charAt(t),t++):(e=s,h===0&&m(ps)),g[r]={nextPos:t,result:e},e)}function X(){var e,r,a,i=t*49+40,c=g[i];return c?(t=c.nextPos,c.result):(o.charCodeAt(t)===10?(e=et,t++):(e=s,h===0&&m(tt)),e===s&&(e=t,o.charCodeAt(t)===13?(r=gs,t++):(r=s,h===0&&m(ms)),r!==s?(o.charCodeAt(t)===10?(a=et,t++):(a=s,h===0&&m(tt)),a!==s?(r=[r,a],e=r):(t=e,e=n)):(t=e,e=n)),g[i]={nextPos:t,result:e},e)}function St(){var e,r=t*49+41,a=g[r];return a?(t=a.nextPos,a.result):(e=X(),e===s&&(e=$()),g[r]={nextPos:t,result:e},e)}function Ce(){var e,r,a=t*49+42,i=g[a];return i?(t=i.nextPos,i.result):(e=t,h++,o.length>t?(r=o.charAt(t),t++):(r=s,h===0&&m(H)),h--,r===s?e=O:(t=e,e=n),g[a]={nextPos:t,result:e},e)}function Q(){var e,r=t*49+43,a=g[r];return a?(t=a.nextPos,a.result):(vs.test(o.charAt(t))?(e=o.charAt(t),t++):(e=s,h===0&&m(ys)),g[r]={nextPos:t,result:e},e)}function M(){var e,r,a=t*49+44,i=g[a];return i?(t=i.nextPos,i.result):($s.test(o.charAt(t))?(e=o.charAt(t),t++):(e=s,h===0&&m(Cs)),e===s&&(e=t,o.charCodeAt(t)===95?(r=xs,t++):(r=s,h===0&&m(Ps)),r!==s&&(x=e,r=bs()),e=r),g[a]={nextPos:t,result:e},e)}function kt(){var e,r=t*49+45,a=g[r];return a?(t=a.nextPos,a.result):(ws.test(o.charAt(t))?(e=o.charAt(t),t++):(e=s,h===0&&m(As)),g[r]={nextPos:t,result:e},e)}function pe(){var e,r,a,i=t*49+46,c=g[i];if(c)return t=c.nextPos,c.result;if(e=t,r=[],a=M(),a!==s)for(;a!==s;)r.push(a),a=M();else r=n;return r!==s&&(x=e,r=Es(r)),e=r,g[i]={nextPos:t,result:e},e}function Mt(){var e,r,a=t*49+47,i=g[a];return i?(t=i.nextPos,i.result):(e=t,o.substr(t,2)===st?(r=st,t+=2):(r=s,h===0&&m(_s)),r!==s&&(x=e,r=Ss()),e=r,e===s&&(e=t,o.substr(t,2)===rt?(r=rt,t+=2):(r=s,h===0&&m(ks)),r!==s&&(x=e,r=Ms()),e=r,e===s&&(e=t,o.substr(t,2)===at?(r=at,t+=2):(r=s,h===0&&m(Ns)),r!==s&&(x=e,r=Ts()),e=r,e===s&&(e=t,o.substr(t,2)===it?(r=it,t+=2):(r=s,h===0&&m(Ls)),r!==s&&(x=e,r=Bs()),e=r,e===s&&(e=t,o.substr(t,2)===nt?(r=nt,t+=2):(r=s,h===0&&m(Vs)),r!==s&&(x=e,r=Os()),e=r,e===s&&(e=t,o.substr(t,2)===ot?(r=ot,t+=2):(r=s,h===0&&m(Ds)),r!==s&&(x=e,r=Fs()),e=r,e===s&&(e=t,o.substr(t,2)===lt?(r=lt,t+=2):(r=s,h===0&&m(Is)),r!==s&&(x=e,r=Rs()),e=r,e===s&&(e=nr()))))))),g[a]={nextPos:t,result:e},e)}function nr(){var e,r,a,i,c,u,d,v,b,N,k,B=t*49+48,V=g[B];return V?(t=V.nextPos,V.result):(e=t,o.substr(t,2)===ct?(r=ct,t+=2):(r=s,h===0&&m(qs)),r!==s?(a=t,i=Q(),i!==s?(c=Q(),c!==s?(u=Q(),u!==s?(d=Q(),d!==s?(v=Q(),v!==s?(b=Q(),b!==s?(N=Q(),N!==s?(k=Q(),k!==s?(i=[i,c,u,d,v,b,N,k],a=i):(t=a,a=n)):(t=a,a=n)):(t=a,a=n)):(t=a,a=n)):(t=a,a=n)):(t=a,a=n)):(t=a,a=n)):(t=a,a=n),a!==s?(x=e,r=ft(a),e=r):(t=e,e=n)):(t=e,e=n),e===s&&(e=t,o.substr(t,2)===ut?(r=ut,t+=2):(r=s,h===0&&m(js)),r!==s?(a=t,i=Q(),i!==s?(c=Q(),c!==s?(u=Q(),u!==s?(d=Q(),d!==s?(i=[i,c,u,d],a=i):(t=a,a=n)):(t=a,a=n)):(t=a,a=n)):(t=a,a=n),a!==s?(x=e,r=ft(a),e=r):(t=e,e=n)):(t=e,e=n)),g[B]={nextPos:t,result:e},e)}var Nt=[];function or(e,r,a){var i=new Error(e);throw i.line=r,i.column=a,i}function Ve(e){Nt.push(e)}function q(e,r,a,i,c){var u={type:e,value:r,line:a(),column:i()};return c&&(u.key=c),u}function lr(e,r,a){var i=parseInt("0x"+e);if(!isFinite(i)||Math.floor(i)!=i||i<0||i>1114111||i>55295&&i<57344)or("Invalid Unicode escape code: "+e,r,a);else return cr(i)}function cr(){var e=16384,r=[],a,i,c=-1,u=arguments.length;if(!u)return"";for(var d="";++c<u;){var v=Number(arguments[c]);v<=65535?r.push(v):(v-=65536,a=(v>>10)+55296,i=v%1024+56320,r.push(a,i)),(c+1==u||r.length>e)&&(d+=String.fromCharCode.apply(null,r),r.length=0)}return d}if(ve=y(),ve!==s&&t===o.length)return ve;throw ve!==s&&t<o.length&&m({type:"end",description:"end of input"}),zs(null,Ne,me)}return{SyntaxError:l,parse:f}}();function gr(E){var l=[],f=[],o="",p=Object.create(null),s=p;return C(E);function C(P){for(var A,_=0;_<P.length;_++)switch(A=P[_],A.type){case"Assign":w(A);break;case"ObjectPath":O(A);break;case"ArrayPath":H(A);break}return p}function y(P,A,_){var S=new Error(P);throw S.line=A,S.column=_,S}function w(P){var A=P.key,_=P.value,S=P.line,U=P.column,F;o?F=o+"."+A:F=A,typeof s[A]<"u"&&y("Cannot redefine existing key '"+F+"'.",S,U),s[A]=L(_),n(F)||(l.push(F),f.push(F))}function n(P){return l.indexOf(P)!==-1}function L(P){return P.type==="Array"?W(P.value):P.type==="InlineTable"?j(P.value):P.value}function j(P){for(var A=Object.create(null),_=0;_<P.length;_++){var S=P[_];S.value.type==="InlineTable"?A[S.key]=j(S.value.value):S.type==="InlineTableValue"&&(A[S.key]=L(S.value))}return A}function O(P){var A=P.value,_=A.map(J).join("."),S=P.line,U=P.column;n(_)&&y("Cannot redefine existing key '"+A+"'.",S,U),l.push(_),s=z(p,A,Object.create(null),S,U),o=A}function H(P){var A=P.value,_=A.map(J).join("."),S=P.line,U=P.column;if(n(_)||l.push(_),l=l.filter(function(K){return K.indexOf(_)!==0}),l.push(_),s=z(p,A,[],S,U),o=_,s instanceof Array){var F=Object.create(null);s.push(F),s=F}else y("Cannot redefine existing key '"+A+"'.",S,U)}function z(P,A,_,S,U){var F=[],K="";A.join(".");for(var D=P,ee=0;ee<A.length;ee++){var te=A[ee];F.push(te),K=F.join("."),typeof D[te]>"u"?ee===A.length-1?D[te]=_:D[te]=Object.create(null):ee!==A.length-1&&f.indexOf(K)>-1&&y("Cannot redefine existing key '"+K+"'.",S,U),D=D[te],D instanceof Array&&D.length&&ee<A.length-1&&(D=D[D.length-1])}return D}function W(P){for(var A=null,_=0;_<P.length;_++){var S=P[_];A===null?A=S.type:S.type!==A&&y("Cannot add value of type "+S.type+" to array of type "+A+".",S.line,S.column)}return P.map(L)}function J(P){return P.indexOf(".")>-1?'"'+P+'"':P}}var mr={compile:gr},vr=pr,yr=mr,$r={parse:function(E){var l=vr.parse(E.toString());return yr.compile(l)}};const Cr=hr($r);class Lt{constructor(l){T(this,"raw");T(this,"tree");this.raw=l;try{this.tree=Cr.parse(l)||{}}catch(f){console.error("TOML parse error",f),this.tree={}}}getRaw(){return this.raw}listVps(){const l=this.tree.aff??{},f=this.tree.url??{},o=this.tree.vps??{},p=[];return Object.entries(o).forEach(([s,C])=>{Object.entries(C).forEach(([y,w])=>{var H,z;const n=w.pid||y,L=((H=f[s])==null?void 0:H.sale_format)??"",j=((z=f[s])==null?void 0:z.valid_format)??"",O=this.resolveAffCode(l[s]);p.push({vendor:s,pid:n,humanComment:w.human_comment||"",saleUrl:this.fillTemplate(L,O,n),validUrl:this.fillTemplate(j,O,n)})})}),p}getIntervalSeconds(l){var o,p;const f=(p=(o=this.tree.url)==null?void 0:o[l])==null?void 0:p.valid_interval_time;return f?Number(f):86400}getDelayRange(l){var y,w;const f=((w=(y=this.tree.url)==null?void 0:y[l])==null?void 0:w.valid_vps_time)??"5-10";if(!f.includes("-")){const n=Math.max(1,Number(f));return{min:n,max:n}}const[o,p]=f.split("-"),s=Math.max(1,Number(o)),C=Math.max(s,Number(p));return{min:s,max:C}}resolveAffCode(l){return l?l.code??Object.values(l).join(""):""}fillTemplate(l,f,o){return l?l.replace("{aff}",encodeURIComponent(f)).replace("{pid}",encodeURIComponent(o)):""}}class De{constructor(l,f){T(this,"element");this.element=document.createElement("div"),this.element.className="asv-modal hidden";const o=document.createElement("div");o.className="asv-modal__body";const p=document.createElement("header");p.className="asv-modal__header",p.innerHTML=`<h3>${l}</h3>`;const s=document.createElement("button");s.className="asv-modal__close",s.type="button",s.textContent="Ã—",s.dataset.logLabel=`å…³é—­ ${l}`,s.addEventListener("click",()=>this.hide()),p.appendChild(s),o.appendChild(p),o.appendChild(f),this.element.appendChild(o)}mount(l){l.appendChild(this.element)}show(){this.element.classList.remove("hidden")}hide(){this.element.classList.add("hidden")}getNode(){return this.element}}class xr{constructor(l,f){T(this,"node");T(this,"timezone");this.node=l,this.timezone=f}setTimezone(l){this.timezone=l}push(l,f="info"){this.renderRow(l,f)}hydrate(l){if(!(l!=null&&l.length))return;[...l].sort((o,p)=>p.ts-o.ts).forEach(o=>{this.renderRow(o.message,o.level,o.ts)})}clear(){this.node.innerHTML=""}renderRow(l,f="info",o){const p=this.formatTime(o),s=document.createElement("div");s.className=`asv-log-row asv-log-${f}`,s.textContent=`[${p}] ${l}`,o?this.node.appendChild(s):this.node.prepend(s)}formatTime(l){const f=l?new Date(l*1e3):new Date;try{return f.toLocaleString("zh-CN",{timeZone:this.timezone,hour12:!1})}catch(o){return console.warn("timezone fallback",o),f.toLocaleString()}}}const Pr="ç­‰å¾…æŠ“å– VPS è¯¦æƒ…ï¼Œä¿å­˜é…ç½®å¹¶éªŒè¯åè‡ªåŠ¨å¡«å……ã€‚";function br(E,l){const f=(E||"").trim();return f.length?f:l.length?l.join(`
`):Pr}function Fe(E){switch(E){case"manual":return"å½“å‰ä¸ºç®¡ç†å‘˜æ‰‹åŠ¨æ•´ç†å†…å®¹";case"ai":return"å·²ç”± AI æ•´ç†å±•ç¤ºä¿¡æ¯";case"raw":default:return"åŸºäºæŠ“å–ç»“æœè‡ªåŠ¨å¡«å……"}}const wr=`[aff]
[aff.rn]
4886

[url]
[url.rn]
sale_format = 'https://my.racknerd.com/aff.php?aff={aff}&pid={pid}'
valid_format = 'https://my.racknerd.com/cart.php?a=add&pid={pid}'
valid_interval_time = '172800'
valid_vps_time = '5-10'

[vps]
[vps.rn.923]
pid = '923'
human_comment = 'éå¸¸åŸºç¡€çš„ä¸€æ¬¾VPSï¼Œä½†æ˜¯å®¹é‡ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ã€‚'

[vps.rn.924]
pid = '924'
human_comment = ''

[vps.rn.925]
pid = '925'
human_comment = ''

[vps.rn.926]
pid = '926'
human_comment = ''

[vps.rn.927]
pid = '927'
human_comment = ''`,Ar=`[model_providers]
[model_providers.omg]
base_url = 'https://api.ohmygpt.com/v1'
model = 'gpt-4.1-mini'
prompt_valid = '''
ä½ æ˜¯ AutoSaleVPS çš„å¯å–æ€§å®¡æ ¸åŠ©æ‰‹ã€‚ä½ å°†æ”¶åˆ°ä¸€ä¸ª JSONï¼Œå…¶ä¸­åŒ…å«ï¼š
- vendor / pid / valid_urlï¼›
- HTTP statusã€ç²¾é€‰å“åº”å¤´ã€æ­£æ–‡æ‘˜è¦ã€HTML æˆªæ–­ç‰‡æ®µï¼›
- initial_state / initial_reasonï¼ˆå¯å‘å¼ç»“è®ºï¼‰ä»¥åŠ signalsï¼ˆå…³é”®å­—å‘½ä¸­åˆ—è¡¨ï¼‰ã€‚

è¯·ç»“åˆæ‰€æœ‰å­—æ®µï¼ˆå°¤å…¶æ˜¯ signals ä¸æ­£æ–‡è¯­ä¹‰ï¼‰åˆ¤æ–­è¯¥ VPS æ˜¯å¦è¿˜å¯ä¸‹å•ï¼Œè‹¥ä¿¡æ¯ä¸è¶³å¯è¿”å› unknownã€‚
è¾“å‡ºè¦æ±‚ï¼š
- å¿…é¡»æ˜¯å•ä¸ª JSON å¯¹è±¡ï¼Œä¸èƒ½å¸¦é¢å¤–æ–‡å­—ã€‚
- å­—æ®µï¼šstatus(online/offline/unknown)ã€reason(<=120å­—ï¼Œæ¦‚è¿°è¯æ®)ã€confidence(0~1 å¯é€‰)ï¼Œå¯æ‰©å±• evidence æ•°ç»„åˆ—å‡ºå…³é”®çº¿ç´¢ã€‚
- è‹¥æ£€æµ‹åˆ°â€œsold outâ€â€œout of stockâ€ç­‰è´Ÿé¢ä¿¡å·ï¼Œç›´æ¥åˆ¤å®š offlineï¼›è‹¥èƒ½ç¡®è®¤æœ‰è´­å…¥æŒ‰é’®/åº“å­˜æç¤ºå†åˆ¤å®š onlineã€‚

ä¸¥æ ¼éµå®ˆ JSON è¾“å‡ºæ ¼å¼ï¼Œé¿å…è‡ªç„¶è¯­è¨€æè¿°ã€‚
'''
prompt_vps_info = 'åŸºäºè¾“å…¥ç»™å‡ºä¸€æ®µæ¨é”€VPSçš„å¹¿å‘Šï¼Œå­—æ•°é™å®šåœ¨40å­—å·¦å³ã€‚æ¨å¹¿è¦æ±‚è´´åˆVPSçš„å®é™…ï¼Œä¸èƒ½æ— è„‘æ¨ã€‚ä»å»ºç«‹åšå®¢ã€AIã€RSSã€Dockerç­‰4ä¸ªåº”ç”¨åœºæ™¯è¯„ä¼°VPSçš„æ¨èæ€§ã€‚ä¸è¦æ·»åŠ æ¨å¹¿é“¾æ¥ï¼Œæˆ‘å·²ç»åœ¨å…¶å®ƒåœ°æ–¹å±•ç¤ºæ¨å¹¿é“¾æ¥ã€‚'
prompt_meta_layout = 'è¯·å°†è¾“å…¥JSONæ•´ç†æˆå›ºå®šçš„8è¡Œä¸­æ–‡ï¼Œä¾æ¬¡ä¸ºï¼šå‚å•†ã€CPUã€å†…å­˜ã€å­˜å‚¨ã€å¸¦å®½ã€ç½‘ç»œã€ä»·æ ¼ã€åœ°ç†ä½ç½®ã€‚æ¯ä¸€è¡Œå¿…é¡»ä½¿ç”¨â€œå­—æ®µï¼šå†…å®¹â€æ ¼å¼ï¼Œå­—æ®µåéœ€ä¸ä¸Šè¿°å®Œå…¨ä¸€è‡´ï¼Œå¦‚ä¿¡æ¯ç¼ºå¤±åˆ™å¡«â€œ-â€ï¼Œä¸è¦è¾“å‡ºå…¶ä»–æ–‡å­—ã€‚'`,Er=`/* é€‚é… https://blognas.hwb0307.com/ad çš„é€šé€å¸ƒå±€ */
.asv-root {
  padding: 0;
  background: transparent;
}

.asv-card {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.58), rgba(226, 239, 255, 0.32));
  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 24px;
  box-shadow: 0 35px 80px rgba(15, 23, 42, 0.25);
  backdrop-filter: blur(12px);
}

.asv-card--offline {
  border-color: rgba(239, 79, 79, 0.5);
  box-shadow: 0 35px 80px rgba(239, 79, 79, 0.4);
}

.asv-sale-btn {
  background: linear-gradient(120deg, #ff9f5a, #f05438);
  color: #fff !important;
  border: none;
  box-shadow: 0 14px 30px rgba(240, 84, 56, 0.3);
}`;class _r{constructor(l,f){T(this,"root");T(this,"rest");T(this,"logPanel");T(this,"logPanelHost");T(this,"logPanelClearButton");T(this,"bootstrap");T(this,"vpsContainer");T(this,"timezoneSelect");T(this,"configBundle");T(this,"modelBundle");T(this,"cssBundle");T(this,"keyModal");T(this,"keyInput");T(this,"hasKey");T(this,"currentConfig");T(this,"currentVps",[]);T(this,"availabilityTimer");T(this,"inFlightValidation",!1);T(this,"extraCssNode");T(this,"timezone");this.root=l,this.bootstrap=f,this.rest=new dr(f.restUrl,f.nonce),this.hasKey=f.hasKey,this.timezone=f.timezone}init(){this.applyExtraCss(this.bootstrap.extraCss||""),this.renderLayout(),this.mountLogPanel(),this.loadPersistedLogs(),this.attachButtonLogs(),this.attachTimezone(),this.attachButtons(),this.loadVpsCards(!0),this.bootstrap.isAdmin||this.loadExtraCss(),this.bootstrap.isAdmin&&(this.prepareModals(),this.loadConfigForEditing(),this.loadModelForEditing(),this.loadExtraCss())}mountLogPanel(){var l;this.logPanel=new xr(this.logPanelHost,this.bootstrap.timezone),(l=this.logPanelClearButton)==null||l.addEventListener("click",()=>{this.logPanel.clear()})}async loadPersistedLogs(){if(this.bootstrap.isAdmin)try{const{logs:l}=await this.rest.fetchLogs();l!=null&&l.length&&this.logPanel.hydrate(l)}catch(l){this.log(`è½½å…¥å†å²æ—¥å¿—å¤±è´¥ï¼š${l.message}`,"error",!1)}}renderLayout(){if(this.root.innerHTML="",this.bootstrap.isAdmin){const C=document.createElement("div");C.className="asv-toolbar";const y=document.createElement("div");y.className="asv-toolbar__row";const w=document.createElement("div");w.className="asv-actions";const n=document.createElement("div");n.className="asv-actions asv-actions--secondary";const L=this.createButton("ç¼–è¾‘VPSé…ç½®","æ‰“å¼€ config.toml ç¼–è¾‘å™¨");L.dataset.action="edit-config";const j=this.createButton("ç¼–è¾‘æ¨¡å‹é…ç½®","æ‰“å¼€ model.toml ç¼–è¾‘å™¨");j.dataset.action="edit-model";const O=this.createButton(this.hasKey?"æ›´æ–°KEY":"æ·»åŠ KEY","æ‰“å¼€ API KEY è®¾ç½®");O.dataset.action="add-key";const H=this.createButton("é¢å¤–CSS","æ‰“å¼€é¢å¤– CSS ç¼–è¾‘å™¨");H.dataset.action="edit-css";const z=this.createButton("å®šæ—¶ä»»åŠ¡ç®¡ç†","ç®¡ç†åå°å®šæ—¶ä»»åŠ¡");z.dataset.action="manage-cron";const W=this.createButton("æ£€æŸ¥å¯ç”¨æ€§","è¿è¡Œè¯Šæ–­");W.dataset.action="diagnostics";const J=this.createButton("æŸ¥çœ‹VPSçŠ¶æ€","åˆ·æ–° VPS åˆ—è¡¨");J.dataset.action="check-vps",w.append(L,j,O,H,z),n.append(W,J);const P=document.createElement("div");P.className="asv-timezone";const A=document.createElement("label");A.textContent="æ—¶åŒº";const _=document.createElement("select");this.bootstrap.options.forEach(S=>{const U=document.createElement("option");U.value=S,U.textContent=S,S===this.bootstrap.timezone&&(U.selected=!0),_.appendChild(U)}),this.timezoneSelect=_,A.appendChild(_),P.appendChild(A),y.append(w,P),C.append(y,n),this.root.appendChild(C)}const l=document.createElement("div");l.className="asv-log-panel";const f=document.createElement("div");f.className="asv-log-panel__header";const o=document.createElement("span");o.textContent="ç³»ç»Ÿæ—¥å¿—";const p=document.createElement("button");p.type="button",p.className="asv-log-panel__clear",p.textContent="æ¸…ç©ºæ—¥å¿—",p.dataset.logSkip="true",f.append(o,p);const s=document.createElement("div");s.className="asv-log-panel__body",l.append(f,s),this.logPanelHost=s,this.logPanelClearButton=p,this.root.appendChild(l),this.vpsContainer=document.createElement("div"),this.vpsContainer.className="asv-vps-list",this.root.appendChild(this.vpsContainer)}createButton(l,f){const o=document.createElement("button");return o.type="button",o.textContent=l,o.className="asv-btn",o.dataset.logLabel=f||l,o}attachButtonLogs(){this.root.addEventListener("click",l=>{if(!this.logPanel)return;const f=l.target,o=f==null?void 0:f.closest("button");if(!o||o.dataset.logSkip==="true")return;const p=(o.dataset.logLabel||o.textContent||"").trim();p&&this.log(`æ“ä½œï¼š${p}`)},!0)}attachTimezone(){var l;(l=this.timezoneSelect)==null||l.addEventListener("change",async()=>{const f=this.timezoneSelect.value;try{await this.rest.saveTimezone(f),this.logPanel.setTimezone(f),this.timezone=f,this.updateCardTimestamps(),this.log(`å·²åˆ‡æ¢åˆ° ${f}`)}catch(o){this.log(`è®¾ç½®æ—¶åŒºå¤±è´¥ï¼š${o.message}`,"error")}})}attachButtons(){this.root.addEventListener("click",l=>{const f=l.target;if(f.matches("[data-action]")){if(!this.bootstrap.isAdmin){this.log("éœ€è¦ç®¡ç†å‘˜æƒé™æ‰§è¡Œæ­¤æ“ä½œ","error");return}switch(f.dataset.action){case"edit-config":this.configBundle.modal.show();break;case"edit-model":this.modelBundle.modal.show();break;case"edit-css":this.cssBundle.modal.show();break;case"add-key":this.keyModal.show();break;case"check-vps":this.handleManualStatusCheck();break;case"diagnostics":this.runDiagnostics();break;case"manage-cron":this.showCronManager();break}}})}async handleManualStatusCheck(){this.bootstrap.isAdmin&&(await this.loadVpsCards(!1),this.triggerAvailabilitySweep("æ‰‹åŠ¨æŸ¥çœ‹VPSçŠ¶æ€"))}prepareModals(){this.configBundle=this.createEditorModal("ç¼–è¾‘ config.toml",wr,async()=>{try{await this.rest.saveConfig(this.configBundle.textarea.value),this.log("é…ç½®å·²ä¿å­˜","success"),this.currentConfig=new Lt(this.configBundle.textarea.value),this.scheduleValidation(),this.configBundle.modal.hide()}catch(s){this.log(`ä¿å­˜å¤±è´¥ï¼š${s.message}`,"error")}},"ä¿å­˜ config.toml"),this.modelBundle=this.createEditorModal("ç¼–è¾‘ model.toml",Ar,async()=>{try{await this.rest.saveModel(this.modelBundle.textarea.value),this.log("æ¨¡å‹é…ç½®å·²ä¿å­˜","success"),this.modelBundle.modal.hide()}catch(s){this.log(`ä¿å­˜æ¨¡å‹å¤±è´¥ï¼š${s.message}`,"error")}},"ä¿å­˜ model.toml"),this.cssBundle=this.createEditorModal("é¢å¤– CSSï¼ˆå¯é€‰ï¼‰",Er,async()=>{try{await this.rest.saveExtraCss(this.cssBundle.textarea.value),this.applyExtraCss(this.cssBundle.textarea.value),this.log("é¢å¤– CSS å·²ä¿å­˜","success"),this.cssBundle.modal.hide()}catch(s){this.log(`ä¿å­˜ CSS å¤±è´¥ï¼š${s.message}`,"error")}},"ä¿å­˜é¢å¤– CSS");const l=document.createElement("div");l.className="asv-modal__content";const f=document.createElement("input");f.type="password",f.placeholder="sk-xxx",f.className="asv-input",this.keyInput=f;const o=document.createElement("button");o.type="button",o.className="asv-eye",o.textContent="ğŸ‘",o.dataset.logLabel="é¢„è§ˆ API KEY",o.addEventListener("mouseenter",()=>{this.keyInput.type="text"}),o.addEventListener("mouseleave",()=>{this.keyInput.type="password"});const p=this.createButton("ä¿å­˜é…ç½®","ä¿å­˜ API KEY");p.addEventListener("click",async()=>{try{await this.rest.saveApiKey(this.keyInput.value),this.hasKey=!0,this.log("API KEY å·²æ›´æ–°","success"),this.keyModal.hide(),this.keyInput.value=""}catch(s){this.log(`ä¿å­˜ KEY å¤±è´¥ï¼š${s.message}`,"error")}}),l.append(f,o,p),this.keyModal=new De("æ·»åŠ /æ›´æ–° KEY",l),this.keyModal.mount(this.root)}createEditorModal(l,f,o,p){const s=document.createElement("div");if(s.className="asv-modal__content",f){const n=document.createElement("details");n.className="asv-helper";const L=document.createElement("summary");L.textContent="æŸ¥çœ‹é»˜è®¤ç¤ºä¾‹";const j=document.createElement("pre");j.textContent=f,n.append(L,j),s.appendChild(n)}const C=document.createElement("textarea");C.className="asv-textarea",C.rows=18;const y=this.createButton("ä¿å­˜é…ç½®",p||`ä¿å­˜ ${l}`);y.addEventListener("click",o),s.append(C,y);const w=new De(l,s);return w.mount(this.root),{modal:w,textarea:C,saveButton:y}}async loadConfigForEditing(){try{const{content:l}=await this.rest.fetchConfig();this.configBundle.textarea.value=l,this.currentConfig=new Lt(l),this.log("å·²è½½å…¥ config.toml","info",!1),this.scheduleValidation()}catch(l){this.log(`è½½å…¥ config.toml å¤±è´¥ï¼š${l.message}`,"error")}}async loadModelForEditing(){try{const{content:l}=await this.rest.fetchModel();this.modelBundle.textarea.value=l,this.log("å·²è½½å…¥ model.toml","info",!1)}catch(l){this.log(`è½½å…¥ model.toml å¤±è´¥ï¼š${l.message}`,"error")}}async loadExtraCss(){try{const{extraCss:l}=await this.rest.fetchExtraCss();this.cssBundle.textarea.value=l,this.applyExtraCss(l),this.log("å·²è½½å…¥é¢å¤– CSS","info",!1)}catch(l){this.log(`è½½å…¥é¢å¤– CSS å¤±è´¥ï¼š${l.message}`,"error")}}async loadVpsCards(l=!0){this.vpsContainer.innerHTML='<div class="asv-loading">æ­£åœ¨è½½å…¥VPSæ•°æ®...</div>';try{const{vps:f}=l?await this.rest.fetchCachedVps():await this.rest.fetchVps();this.currentVps=f,this.renderVpsList(f),this.bootstrap.isAdmin&&(l?this.log("å·²è½½å…¥ç¼“å­˜çš„ VPS çŠ¶æ€ï¼Œå¦‚éœ€æ›´æ–°è¯·ç‚¹å‡»â€œæŸ¥çœ‹VPSçŠ¶æ€â€","info",!1):this.log("å·²æŠ“å–æœ€æ–° VPS æ•°æ®","success"),this.scheduleValidation())}catch(f){this.vpsContainer.innerHTML='<p class="asv-error">æ— æ³•è·å–VPSä¿¡æ¯</p>',this.log(`è·å–VPSå¤±è´¥ï¼š${f.message}`,"error")}}renderVpsList(l){if(this.vpsContainer.innerHTML="",!l.length){this.vpsContainer.innerHTML="<p>æš‚æ—  VPS è®°å½•</p>";return}l.forEach(f=>{const o=document.createElement("article");o.className="asv-card",o.dataset.key=`${f.vendor}-${f.pid}`,f.available===!1&&o.classList.add("asv-card--offline"),f.checked_at&&(o.dataset.checkedAt=`${f.checked_at}`);const p=document.createElement("div");p.className="asv-card__title";const s=document.createElement("strong");s.textContent=`${f.vendor.toUpperCase()} #${f.pid}`,p.append(s,this.createStatusPill(f)),o.appendChild(p);const C=document.createElement("a");if(C.href=f.sale_url,C.target="_blank",C.rel="noopener",C.className="asv-sale-btn",C.textContent="æ‰“å¼€æ¨å¹¿é“¾æ¥",o.appendChild(C),this.bootstrap.isAdmin)o.appendChild(this.createPromoEditor(f));else{const n=document.createElement("p");n.className="asv-card__promo",n.textContent=this.formatPromo(f),o.appendChild(n)}if(this.bootstrap.isAdmin?o.appendChild(this.createMetaEditor(f)):o.appendChild(this.createMetaViewer(f)),f.human_comment){const n=document.createElement("div");n.className="asv-card__note",n.textContent=f.human_comment,o.appendChild(n)}const y=document.createElement("footer");if(y.className="asv-card__footer",this.bootstrap.isAdmin){const n=`${f.vendor.toUpperCase()}#${f.pid}`,L=this.createButton("éªŒè¯",`éªŒè¯ ${n}`);L.classList.add("asv-btn--ghost"),L.addEventListener("click",()=>this.validateSingle(f.vendor,f.pid,"æ‰‹åŠ¨éªŒè¯")),y.appendChild(L)}const w=document.createElement("div");w.className="asv-card__timestamp",w.textContent=this.formatCheckedAt(f.checked_at),y.prepend(w),o.appendChild(y),this.vpsContainer.appendChild(o)})}createPromoEditor(l){const f=document.createElement("div");f.className="asv-promo-editor";const o=document.createElement("textarea");o.className="asv-promo-editor__textarea",o.value=l.promo||"",o.placeholder="è¾“å…¥è‡ªå®šä¹‰æ¨å¹¿è¯­ï¼Œ20-100 å­—ï¼Œä¿æŒçœŸå®é…ç½®ã€‚",f.appendChild(o);const p=document.createElement("div");p.className="asv-promo-actions";const s=`${l.vendor.toUpperCase()}#${l.pid}`,C=this.createButton("ä¿å­˜æ¨å¹¿è¯­",`ä¿å­˜æ¨å¹¿è¯­ ${s}`);C.classList.add("asv-btn--sm");const y=this.createButton("AI é‡å†™",`AI é‡å†™æ¨å¹¿è¯­ ${s}`);return y.classList.add("asv-btn--ghost","asv-btn--sm"),C.addEventListener("click",()=>this.persistPromoOverride(l.vendor,l.pid,o,C,y)),y.addEventListener("click",()=>this.regeneratePromo(l.vendor,l.pid,o,C,y)),p.append(C,y),f.appendChild(p),f}createMetaViewer(l){const f=document.createElement("div");f.className="asv-meta-section";const o=document.createElement("pre");return o.className="asv-meta-block",o.textContent=this.formatMetaDisplay(l),f.appendChild(o),f}createMetaEditor(l){const f=document.createElement("div");f.className="asv-meta-editor";const o=document.createElement("textarea");o.className="asv-meta-editor__textarea asv-meta-block",o.value=this.formatMetaDisplay(l),o.spellcheck=!1,f.appendChild(o);const p=document.createElement("div");p.className="asv-meta-hint",p.textContent=Fe(l.meta_source),f.appendChild(p);const s=document.createElement("div");s.className="asv-meta-actions";const C=`${l.vendor.toUpperCase()}#${l.pid}`,y=this.createButton("ä¿å­˜ä¿¡æ¯",`ä¿å­˜å…ƒä¿¡æ¯ ${C}`);y.classList.add("asv-btn--sm");const w=this.createButton("AI æ•´ç†",`AI æ•´ç†å…ƒä¿¡æ¯ ${C}`);return w.classList.add("asv-btn--ghost","asv-btn--sm"),y.addEventListener("click",()=>this.persistMetaOverride(l.vendor,l.pid,o,p,y,w)),w.addEventListener("click",()=>this.regenerateMeta(l.vendor,l.pid,o,p,y,w)),s.append(y,w),f.appendChild(s),f}formatMetaDisplay(l){return br(l.meta_display,l.meta||[])}togglePromoButtons(l,...f){f.forEach(o=>{o.disabled=l})}toggleMetaButtons(l,...f){f.forEach(o=>{o.disabled=l})}async persistPromoOverride(l,f,o,p,s){const C=o.value.trim();if(!C){this.log("æ¨å¹¿è¯­ä¸èƒ½ä¸ºç©º","error"),o.focus();return}this.togglePromoButtons(!0,p,s);try{const y=await this.rest.savePromo(l,f,C);o.value=y.promo||"",this.updatePromoRecord(l,f,y.promo,y.source),this.log(`${l} ${f} æ¨å¹¿è¯­å·²ä¿å­˜`,"success")}catch(y){this.log(`ä¿å­˜æ¨å¹¿è¯­å¤±è´¥ï¼š${y.message}`,"error")}finally{this.togglePromoButtons(!1,p,s)}}async persistMetaOverride(l,f,o,p,s,C){const y=o.value.trim();if(!y){this.log("å±•ç¤ºä¿¡æ¯ä¸èƒ½ä¸ºç©º","error"),o.focus();return}this.toggleMetaButtons(!0,s,C);try{const w=await this.rest.saveMeta(l,f,y),n=w.content||"";o.value=n,p.textContent=Fe(w.source),this.updateMetaRecord(l,f,n,w.source),this.log(`${l} ${f} å…ƒä¿¡æ¯å·²ä¿å­˜`,"success")}catch(w){this.log(`ä¿å­˜å…ƒä¿¡æ¯å¤±è´¥ï¼š${w.message}`,"error")}finally{this.toggleMetaButtons(!1,s,C)}}async regenerateMeta(l,f,o,p,s,C){this.toggleMetaButtons(!0,s,C);try{const y=await this.rest.refreshMeta(l,f),w=y.content||"";o.value=w,p.textContent=Fe(y.source),this.updateMetaRecord(l,f,w,y.source),this.log(`${l} ${f} å…ƒä¿¡æ¯å·²ç”± AI æ•´ç†`,"success")}catch(y){this.log(`AI æ•´ç†å¤±è´¥ï¼š${y.message}`,"error")}finally{this.toggleMetaButtons(!1,s,C)}}async regeneratePromo(l,f,o,p,s){this.togglePromoButtons(!0,p,s);try{const C=await this.rest.refreshPromo(l,f);o.value=C.promo||"",this.updatePromoRecord(l,f,C.promo,C.source),this.log(`${l} ${f} æ¨å¹¿è¯­å·²é‡æ–°ç”Ÿæˆ`,"success")}catch(C){this.log(`é‡æ–°ç”Ÿæˆæ¨å¹¿è¯­å¤±è´¥ï¼š${C.message}`,"error")}finally{this.togglePromoButtons(!1,p,s)}}updatePromoRecord(l,f,o,p){const s=this.currentVps.find(C=>C.vendor===l&&C.pid===f);s&&(s.promo=o,s.promo_source=p)}updateMetaRecord(l,f,o,p){const s=this.currentVps.find(C=>C.vendor===l&&C.pid===f);s&&(s.meta_display=o,s.meta_source=p)}formatPromo(l){return l.promo||"ç­‰å¾…ç”Ÿæˆæ¨å¹¿è¯æœ¯..."}createStatusPill(l){const f=document.createElement("span");return f.className="asv-status-pill",l.available===null?(f.classList.add("asv-status-pill--idle"),f.textContent="ç­‰å¾…éªŒè¯"):l.available?(f.classList.add("asv-status-pill--up"),f.textContent="åœ¨çº¿"):(f.classList.add("asv-status-pill--down"),f.textContent="å·²å”®ç½„"),f}scheduleValidation(){this.availabilityTimer&&(window.clearInterval(this.availabilityTimer),this.availabilityTimer=void 0)}triggerAvailabilitySweep(l){!this.bootstrap.isAdmin||this.inFlightValidation||(this.inFlightValidation=!0,this.log(`${l}ï¼šå¼€å§‹éªŒè¯æ‰€æœ‰ VPS`),this.validateAll().catch(f=>this.log(`æ‰¹é‡éªŒè¯å¤±è´¥ï¼š${f.message}`,"error")).finally(()=>{this.inFlightValidation=!1}))}async validateAll(){var l;for(const f of this.currentVps){await this.validateSingle(f.vendor,f.pid,"æ‰¹é‡é˜Ÿåˆ—");const o=((l=this.currentConfig)==null?void 0:l.getDelayRange(f.vendor))??{min:5,max:10},p=this.randomDelay(o.min,o.max);await this.sleep(p)}}async validateSingle(l,f,o){try{const p=await this.rest.validateVps(l,f);this.log(`${o}ï¼š${l} ${f} -> ${p.available?"åœ¨çº¿":"å”®ç½„"} (${p.message})`),this.applyStatus(l,f,p.available,p.message,p.checked_at)}catch(p){this.log(`éªŒè¯ ${l} ${f} å¤±è´¥ï¼š${p.message}`,"error")}}applyStatus(l,f,o,p,s){var n;const C=`${l}-${f}`,y=this.vpsContainer.querySelector(`[data-key="${C}"]`);if(y){y.classList.toggle("asv-card--offline",!o);const L=y.querySelector(".asv-status-pill");L&&(L.textContent=o?"åœ¨çº¿":"å·²å”®ç½„",L.className=`asv-status-pill ${o?"asv-status-pill--up":"asv-status-pill--down"}`),(n=y.querySelector(".asv-soldout"))==null||n.remove();const j=s??Math.floor(Date.now()/1e3);j?y.dataset.checkedAt=`${j}`:delete y.dataset.checkedAt;const O=y.querySelector(".asv-card__timestamp");O&&(O.textContent=this.formatCheckedAt(j))}const w=this.currentVps.find(L=>L.vendor===l&&L.pid===f);if(w){const L=s??Math.floor(Date.now()/1e3);w.available=o,w.message=p,w.checked_at=L}}async runDiagnostics(){try{const l=await this.rest.runDiagnostics();this.renderDiagnostics(l)}catch(l){this.log(`è¯Šæ–­å¤±è´¥ï¼š${l.message}`,"error")}}renderDiagnostics(l){this.log(`ç½‘ç»œï¼š${l.network.ok?"æ­£å¸¸":"å¼‚å¸¸"} - ${l.network.message}`),this.log(`LLMï¼š${l.llm.ok?"å°±ç»ª":"å¼‚å¸¸"} - ${l.llm.message}`)}log(l,f="info",o=!0){this.logPanel&&this.logPanel.push(l,f),!(!o||!this.bootstrap.isAdmin)&&this.rest.appendLog(l,f).catch(p=>{this.logPanel&&this.logPanel.push(`å†™å…¥æ—¥å¿—å¤±è´¥ï¼š${p.message}`,"error")})}applyExtraCss(l){const f=(l||"").trim();if(!f){this.extraCssNode&&(this.extraCssNode.remove(),this.extraCssNode=void 0);return}if(!this.extraCssNode){const o=document.createElement("style");o.dataset.source="asv-extra-css",document.head.appendChild(o),this.extraCssNode=o}this.extraCssNode.textContent=f}randomDelay(l,f){const o=f-l;return(l+Math.random()*o)*1e3}sleep(l){return new Promise(f=>{window.setTimeout(f,l)})}formatCheckedAt(l){if(!l)return"æœ€åæ›´æ–°æ—¶é—´ï¼š-";try{return`æœ€åæ›´æ–°æ—¶é—´ï¼š${new Date(l*1e3).toLocaleString("zh-CN",{timeZone:this.timezone,hour12:!1})}`}catch(f){return console.warn("formatCheckedAt fallback",f),`æœ€åæ›´æ–°æ—¶é—´ï¼š${new Date(l*1e3).toLocaleString()}`}}updateCardTimestamps(){this.vpsContainer.querySelectorAll(".asv-card").forEach(l=>{const f=l.dataset.checkedAt,o=l.querySelector(".asv-card__timestamp");if(!o)return;const p=f?Number(f):null;o.textContent=this.formatCheckedAt(Number.isFinite(p)?p:null)})}showCronManager(){this.log("æ­£åœ¨åŠ è½½å®šæ—¶ä»»åŠ¡çŠ¶æ€..."),this.fetchCronStatus()}async fetchCronStatus(){try{const f=await(await this.rest.fetch("/cron")).json();this.renderCronModal(f)}catch(l){this.log(`è·å–å®šæ—¶ä»»åŠ¡çŠ¶æ€å¤±è´¥ï¼š${l.message}`,"error")}}renderCronModal(l){const f=new De("å®šæ—¶ä»»åŠ¡ç®¡ç†",this.createCronModalContent(l));f.mount(this.root),f.show()}createCronModalContent(l){const f=document.createElement("div");f.className="asv-modal__content";const o=document.createElement("div");o.className="asv-cron-status",o.innerHTML=`
      <p><strong>çŠ¶æ€ï¼š</strong><span class="${l.active?"asv-status-active":"asv-status-inactive"}">
        ${l.active?"âœ“ å·²æ¿€æ´»":"âœ— æœªæ¿€æ´»"}
      </span></p>
      <p><strong>è¯´æ˜ï¼š</strong>${l.message}</p>
      ${l.next_run?`<p><strong>ä¸‹æ¬¡è¿è¡Œï¼š</strong>${l.next_run}</p>`:"<p><strong>ä¸‹æ¬¡è¿è¡Œï¼š</strong>æœªè®¡åˆ’</p>"}
    `,f.appendChild(o);const p=document.createElement("div");if(p.className="asv-cron-actions",l.active){const n=this.createButton("åœæ­¢å®šæ—¶ä»»åŠ¡","åœæ­¢æ‰€æœ‰åå° VPS æ£€æŸ¥");n.addEventListener("click",()=>this.manageCron("stop")),p.appendChild(n)}else{const n=this.createButton("å¯åŠ¨å®šæ—¶ä»»åŠ¡","å¼€å§‹åå° VPS æ£€æŸ¥");n.addEventListener("click",()=>this.manageCron("start")),p.appendChild(n)}const s=document.createElement("div");s.className="asv-cron-reschedule",s.innerHTML=`
      <p><strong>é‡æ–°å®‰æ’é—´éš”ï¼š</strong></p>
      <div class="asv-cron-interval">
        <select id="cron-interval">
          <option value="hourly">æ¯å°æ—¶</option>
          <option value="twicedaily">æ¯å¤©ä¸¤æ¬¡</option>
          <option value="daily">æ¯å¤©</option>
        </select>
        <button class="asv-btn">æ›´æ–°</button>
      </div>
    `;const C=s.querySelector("button"),y=s.querySelector("#cron-interval");C==null||C.addEventListener("click",()=>{this.manageCron("reschedule",y.value)}),f.appendChild(p),f.appendChild(s);const w=document.createElement("div");return w.className="asv-cron-note",w.innerHTML=`
      <p><em>æ³¨æ„ï¼šå®šæ—¶ä»»åŠ¡åœ¨æœåŠ¡å™¨åå°è¿è¡Œï¼Œä¸éœ€è¦ä¿æŒé¡µé¢æ‰“å¼€ã€‚VPS æ£€æŸ¥é—´éš”ç”± config.toml ä¸­çš„ valid_interval_time æ§åˆ¶ã€‚</em></p>
    `,f.appendChild(w),f}async manageCron(l,f){try{const p=await(await this.rest.fetch("/cron",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:l,interval:f})})).json();if(p.success){this.log(p.message,"success");const s=document.querySelector(".asv-modal");s&&s.remove(),this.fetchCronStatus()}else this.log(`æ“ä½œå¤±è´¥ï¼š${p.message}`,"error")}catch(o){this.log(`å®šæ—¶ä»»åŠ¡æ“ä½œå¤±è´¥ï¼š${o.message}`,"error")}}}let Bt=!1,Ie=null;const Sr=()=>window.ASV_BOOTSTRAP?!0:(Bt||(console.warn("AutoSaleVPS: ç¼ºå°‘åˆå§‹åŒ–æ•°æ®"),Bt=!0),!1),Vt=E=>E?E.id==="asv-root"?E:E.querySelector("#asv-root"):document.getElementById("asv-root"),Re=E=>{if(!Sr())return!1;const l=Vt(E);return!l||l.dataset.asvMounted==="true"?!!l:(new _r(l,window.ASV_BOOTSTRAP).init(),l.dataset.asvMounted="true",!0)};window.AutoSaleVPSMount=Re;const kr=()=>{if(Ie||typeof MutationObserver>"u")return;Ie=new MutationObserver(l=>{l.forEach(f=>{f.addedNodes.forEach(o=>{if(!(o instanceof HTMLElement))return;const p=Vt(o);p&&Re(p)})})});const E=document.body||document.documentElement;E&&Ie.observe(E,{childList:!0,subtree:!0})};Re();kr();
//# sourceMappingURL=main.js.map
