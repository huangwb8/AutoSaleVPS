var ur=Object.defineProperty;var fr=(E,c,u)=>c in E?ur(E,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):E[c]=u;var T=(E,c,u)=>fr(E,typeof c!="symbol"?c+"":c,u);class hr{constructor(c,u){T(this,"baseUrl");T(this,"nonce");this.baseUrl=c.replace(/\/$/,""),this.nonce=u}async request(c,u={}){const l=await fetch(`${this.baseUrl}/${c.replace(/^\//,"")}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":this.nonce,...u.headers||{}},credentials:"same-origin",...u});if(!l.ok){const g=await l.text();throw new Error(g||"è¯·æ±‚å¤±è´¥")}return l.status===204?{}:await l.json()}fetchConfig(){return this.request("/config")}saveConfig(c){return this.request("/config",{method:"POST",body:JSON.stringify({content:c})})}fetchModel(){return this.request("/model")}saveModel(c){return this.request("/model",{method:"POST",body:JSON.stringify({content:c})})}saveApiKey(c){return this.request("/key",{method:"POST",body:JSON.stringify({api_key:c})})}fetchVps(){return this.request("/vps")}fetchCachedVps(){return this.request("/vps/cached")}validateVps(c,u){return this.request("/vps/validate",{method:"POST",body:JSON.stringify({vendor:c,pid:u})})}refreshPromo(c,u){return this.request("/vps/promo",{method:"POST",body:JSON.stringify({vendor:c,pid:u})})}savePromo(c,u,l){return this.request("/vps/promo",{method:"POST",body:JSON.stringify({vendor:c,pid:u,content:l})})}refreshMeta(c,u){return this.request("/vps/meta",{method:"POST",body:JSON.stringify({vendor:c,pid:u})})}saveMeta(c,u,l){return this.request("/vps/meta",{method:"POST",body:JSON.stringify({vendor:c,pid:u,content:l})})}runDiagnostics(){return this.request("/diagnostics",{method:"POST"})}saveTimezone(c){return this.request("/timezone",{method:"POST",body:JSON.stringify({timezone:c})})}fetchExtraCss(){return this.request("/design")}saveExtraCss(c){return this.request("/design",{method:"POST",body:JSON.stringify({extra_css:c})})}}function dr(E){return E&&E.__esModule&&Object.prototype.hasOwnProperty.call(E,"default")?E.default:E}var pr=function(){function E(l,g){function s(){this.constructor=l}s.prototype=g.prototype,l.prototype=new s}function c(l,g,s,C,$,w){this.message=l,this.expected=g,this.found=s,this.offset=C,this.line=$,this.column=w,this.name="SyntaxError"}E(c,Error);function u(l){var g=arguments.length>1?arguments[1]:{},s={},C={start:ft},$=ft,w=function(){return Mt},n=s,B="#",z={type:"literal",value:"#",description:'"#"'},O=void 0,U={type:"any",description:"any character"},j="[",Y={type:"literal",value:"[",description:'"["'},K="]",x={type:"literal",value:"]",description:'"]"'},A=function(e){Ve(q("ObjectPath",e,I,R))},k=function(e){Ve(q("ArrayPath",e,I,R))},_=function(e,r){return e.concat(r)},Q=function(e){return[e]},F=function(e){return e},H=".",D={type:"literal",value:".",description:'"."'},ee="=",te={type:"literal",value:"=",description:'"="'},Re=function(e,r){Ve(q("Assign",r,I,R,e))},Ot=function(e){return e.join("")},qe=function(e){return e.value},ae='"""',Ce={type:"literal",value:'"""',description:'"\\"\\"\\""'},re=null,ge=function(e){return q("String",e.join(""),I,R)},xe='"',be={type:"literal",value:'"',description:'"\\""'},ie="'''",Ae={type:"literal",value:"'''",description:`"'''"`},we="'",Ee={type:"literal",value:"'",description:`"'"`},_e=function(e){return e},Dt=function(e){return e},Ft="\\",It={type:"literal",value:"\\",description:'"\\\\"'},Rt=function(){return""},qt="e",zt={type:"literal",value:"e",description:'"e"'},jt="E",Ut={type:"literal",value:"E",description:'"E"'},Kt=function(e,r){return q("Float",parseFloat(e+"e"+r),I,R)},Ht=function(e){return q("Float",parseFloat(e),I,R)},ke="+",Se={type:"literal",value:"+",description:'"+"'},ze=function(e){return e.join("")},oe="-",ce={type:"literal",value:"-",description:'"-"'},je=function(e){return"-"+e.join("")},Jt=function(e){return q("Integer",parseInt(e,10),I,R)},Ue="true",Zt={type:"literal",value:"true",description:'"true"'},Yt=function(){return q("Boolean",!0,I,R)},Ke="false",Wt={type:"literal",value:"false",description:'"false"'},Gt=function(){return q("Boolean",!1,I,R)},Xt=function(){return q("Array",[],I,R)},Qt=function(e){return q("Array",e?[e]:[],I,R)},es=function(e){return q("Array",e,I,R)},ts=function(e,r){return q("Array",e.concat(r),I,R)},He=function(e){return e},Je=",",Ze={type:"literal",value:",",description:'","'},ss="{",rs={type:"literal",value:"{",description:'"{"'},as="}",is={type:"literal",value:"}",description:'"}"'},ns=function(e){return q("InlineTable",e,I,R)},Ye=function(e,r){return q("InlineTableValue",r,I,R,e)},ls=function(e){return"."+e},os=function(e){return e.join("")},ue=":",fe={type:"literal",value:":",description:'":"'},We=function(e){return e.join("")},Ge="T",Xe={type:"literal",value:"T",description:'"T"'},cs="Z",us={type:"literal",value:"Z",description:'"Z"'},fs=function(e,r){return q("Date",new Date(e+"T"+r+"Z"),I,R)},hs=function(e,r){return q("Date",new Date(e+"T"+r),I,R)},ds=/^[ \t]/,ps={type:"class",value:"[ \\t]",description:"[ \\t]"},Qe=`
`,et={type:"literal",value:`
`,description:'"\\n"'},gs="\r",ms={type:"literal",value:"\r",description:'"\\r"'},vs=/^[0-9a-f]/i,ys={type:"class",value:"[0-9a-f]i",description:"[0-9a-f]i"},$s=/^[0-9]/,Ps={type:"class",value:"[0-9]",description:"[0-9]"},Cs="_",xs={type:"literal",value:"_",description:'"_"'},bs=function(){return""},As=/^[A-Za-z0-9_\-]/,ws={type:"class",value:"[A-Za-z0-9_\\-]",description:"[A-Za-z0-9_\\-]"},Es=function(e){return e.join("")},tt='\\"',_s={type:"literal",value:'\\"',description:'"\\\\\\""'},ks=function(){return'"'},st="\\\\",Ss={type:"literal",value:"\\\\",description:'"\\\\\\\\"'},Ms=function(){return"\\"},rt="\\b",Ns={type:"literal",value:"\\b",description:'"\\\\b"'},Ts=function(){return"\b"},at="\\t",Bs={type:"literal",value:"\\t",description:'"\\\\t"'},Ls=function(){return"	"},it="\\n",Vs={type:"literal",value:"\\n",description:'"\\\\n"'},Os=function(){return`
`},nt="\\f",Ds={type:"literal",value:"\\f",description:'"\\\\f"'},Fs=function(){return"\f"},lt="\\r",Is={type:"literal",value:"\\r",description:'"\\\\r"'},Rs=function(){return"\r"},ot="\\U",qs={type:"literal",value:"\\U",description:'"\\\\U"'},ct=function(e){return or(e.join(""))},ut="\\u",zs={type:"literal",value:"\\u",description:'"\\\\u"'},t=0,P=0,he=0,Me={line:1,column:1,seenCR:!1},me=0,Ne=[],d=0,p={},ve;if("startRule"in g){if(!(g.startRule in C))throw new Error(`Can't start parsing from rule "`+g.startRule+'".');$=C[g.startRule]}function I(){return Te(P).line}function R(){return Te(P).column}function Te(e){function r(a,i,o){var f,h;for(f=i;f<o;f++)h=l.charAt(f),h===`
`?(a.seenCR||a.line++,a.column=1,a.seenCR=!1):h==="\r"||h==="\u2028"||h==="\u2029"?(a.line++,a.column=1,a.seenCR=!0):(a.column++,a.seenCR=!1)}return he!==e&&(he>e&&(he=0,Me={line:1,column:1,seenCR:!1}),r(Me,he,e),he=e),Me}function m(e){t<me||(t>me&&(me=t,Ne=[]),Ne.push(e))}function js(e,r,a){function i(v){var b=1;for(v.sort(function(N,S){return N.description<S.description?-1:N.description>S.description?1:0});b<v.length;)v[b-1]===v[b]?v.splice(b,1):b++}function o(v,b){function N(le){function se(Z){return Z.charCodeAt(0).toString(16).toUpperCase()}return le.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(Z){return"\\x0"+se(Z)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(Z){return"\\x"+se(Z)}).replace(/[\u0180-\u0FFF]/g,function(Z){return"\\u0"+se(Z)}).replace(/[\u1080-\uFFFF]/g,function(Z){return"\\u"+se(Z)})}var S=new Array(v.length),L,V,J;for(J=0;J<v.length;J++)S[J]=v[J].description;return L=v.length>1?S.slice(0,-1).join(", ")+" or "+S[v.length-1]:S[0],V=b?'"'+N(b)+'"':"end of input","Expected "+L+" but "+V+" found."}var f=Te(a),h=a<l.length?l.charAt(a):null;return r!==null&&i(r),new c(o(r,h),r,h,a,f.line,f.column)}function ft(){var e,r,a,i=t*49+0,o=p[i];if(o)return t=o.nextPos,o.result;for(e=t,r=[],a=ht();a!==s;)r.push(a),a=ht();return r!==s&&(P=e,r=w()),e=r,p[i]={nextPos:t,result:e},e}function ht(){var e,r,a,i,o,f,h,v=t*49+1,b=p[v];if(b)return t=b.nextPos,b.result;for(e=t,r=[],a=y();a!==s;)r.push(a),a=y();if(r!==s)if(a=Us(),a!==s){for(i=[],o=y();o!==s;)i.push(o),o=y();if(i!==s){for(o=[],f=ye();f!==s;)o.push(f),f=ye();if(o!==s){if(f=[],h=G(),h!==s)for(;h!==s;)f.push(h),h=G();else f=n;f===s&&(f=Pe()),f!==s?(r=[r,a,i,o,f],e=r):(t=e,e=n)}else t=e,e=n}else t=e,e=n}else t=e,e=n;else t=e,e=n;if(e===s){if(e=t,r=[],a=y(),a!==s)for(;a!==s;)r.push(a),a=y();else r=n;if(r!==s){if(a=[],i=G(),i!==s)for(;i!==s;)a.push(i),i=G();else a=n;a===s&&(a=Pe()),a!==s?(r=[r,a],e=r):(t=e,e=n)}else t=e,e=n;e===s&&(e=G())}return p[v]={nextPos:t,result:e},e}function Us(){var e,r=t*49+2,a=p[r];return a?(t=a.nextPos,a.result):(e=ye(),e===s&&(e=Ks(),e===s&&(e=Hs(),e===s&&(e=Js()))),p[r]={nextPos:t,result:e},e)}function ye(){var e,r,a,i,o,f,h=t*49+3,v=p[h];if(v)return t=v.nextPos,v.result;if(e=t,l.charCodeAt(t)===35?(r=B,t++):(r=s,d===0&&m(z)),r!==s){for(a=[],i=t,o=t,d++,f=G(),f===s&&(f=Pe()),d--,f===s?o=O:(t=o,o=n),o!==s?(l.length>t?(f=l.charAt(t),t++):(f=s,d===0&&m(U)),f!==s?(o=[o,f],i=o):(t=i,i=n)):(t=i,i=n);i!==s;)a.push(i),i=t,o=t,d++,f=G(),f===s&&(f=Pe()),d--,f===s?o=O:(t=o,o=n),o!==s?(l.length>t?(f=l.charAt(t),t++):(f=s,d===0&&m(U)),f!==s?(o=[o,f],i=o):(t=i,i=n)):(t=i,i=n);a!==s?(r=[r,a],e=r):(t=e,e=n)}else t=e,e=n;return p[h]={nextPos:t,result:e},e}function Ks(){var e,r,a,i,o,f,h=t*49+4,v=p[h];if(v)return t=v.nextPos,v.result;if(e=t,l.charCodeAt(t)===91?(r=j,t++):(r=s,d===0&&m(Y)),r!==s){for(a=[],i=y();i!==s;)a.push(i),i=y();if(a!==s)if(i=dt(),i!==s){for(o=[],f=y();f!==s;)o.push(f),f=y();o!==s?(l.charCodeAt(t)===93?(f=K,t++):(f=s,d===0&&m(x)),f!==s?(P=e,r=A(i),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;return p[h]={nextPos:t,result:e},e}function Hs(){var e,r,a,i,o,f,h,v,b=t*49+5,N=p[b];if(N)return t=N.nextPos,N.result;if(e=t,l.charCodeAt(t)===91?(r=j,t++):(r=s,d===0&&m(Y)),r!==s)if(l.charCodeAt(t)===91?(a=j,t++):(a=s,d===0&&m(Y)),a!==s){for(i=[],o=y();o!==s;)i.push(o),o=y();if(i!==s)if(o=dt(),o!==s){for(f=[],h=y();h!==s;)f.push(h),h=y();f!==s?(l.charCodeAt(t)===93?(h=K,t++):(h=s,d===0&&m(x)),h!==s?(l.charCodeAt(t)===93?(v=K,t++):(v=s,d===0&&m(x)),v!==s?(P=e,r=k(o),e=r):(t=e,e=n)):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n;return p[b]={nextPos:t,result:e},e}function dt(){var e,r,a,i=t*49+6,o=p[i];if(o)return t=o.nextPos,o.result;if(e=t,r=[],a=gt(),a!==s)for(;a!==s;)r.push(a),a=gt();else r=n;return r!==s?(a=pt(),a!==s?(P=e,r=_(r,a),e=r):(t=e,e=n)):(t=e,e=n),e===s&&(e=t,r=pt(),r!==s&&(P=e,r=Q(r)),e=r),p[i]={nextPos:t,result:e},e}function pt(){var e,r,a,i,o,f=t*49+7,h=p[f];if(h)return t=h.nextPos,h.result;for(e=t,r=[],a=y();a!==s;)r.push(a),a=y();if(r!==s)if(a=de(),a!==s){for(i=[],o=y();o!==s;)i.push(o),o=y();i!==s?(P=e,r=F(a),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n;if(e===s){for(e=t,r=[],a=y();a!==s;)r.push(a),a=y();if(r!==s)if(a=Be(),a!==s){for(i=[],o=y();o!==s;)i.push(o),o=y();i!==s?(P=e,r=F(a),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n}return p[f]={nextPos:t,result:e},e}function gt(){var e,r,a,i,o,f,h,v=t*49+8,b=p[v];if(b)return t=b.nextPos,b.result;for(e=t,r=[],a=y();a!==s;)r.push(a),a=y();if(r!==s)if(a=de(),a!==s){for(i=[],o=y();o!==s;)i.push(o),o=y();if(i!==s)if(l.charCodeAt(t)===46?(o=H,t++):(o=s,d===0&&m(D)),o!==s){for(f=[],h=y();h!==s;)f.push(h),h=y();f!==s?(P=e,r=F(a),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n;if(e===s){for(e=t,r=[],a=y();a!==s;)r.push(a),a=y();if(r!==s)if(a=Be(),a!==s){for(i=[],o=y();o!==s;)i.push(o),o=y();if(i!==s)if(l.charCodeAt(t)===46?(o=H,t++):(o=s,d===0&&m(D)),o!==s){for(f=[],h=y();h!==s;)f.push(h),h=y();f!==s?(P=e,r=F(a),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n}return p[v]={nextPos:t,result:e},e}function Js(){var e,r,a,i,o,f,h=t*49+9,v=p[h];if(v)return t=v.nextPos,v.result;if(e=t,r=de(),r!==s){for(a=[],i=y();i!==s;)a.push(i),i=y();if(a!==s)if(l.charCodeAt(t)===61?(i=ee,t++):(i=s,d===0&&m(te)),i!==s){for(o=[],f=y();f!==s;)o.push(f),f=y();o!==s?(f=ne(),f!==s?(P=e,r=Re(r,f),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;if(e===s)if(e=t,r=Be(),r!==s){for(a=[],i=y();i!==s;)a.push(i),i=y();if(a!==s)if(l.charCodeAt(t)===61?(i=ee,t++):(i=s,d===0&&m(te)),i!==s){for(o=[],f=y();f!==s;)o.push(f),f=y();o!==s?(f=ne(),f!==s?(P=e,r=Re(r,f),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;return p[h]={nextPos:t,result:e},e}function de(){var e,r,a,i=t*49+10,o=p[i];if(o)return t=o.nextPos,o.result;if(e=t,r=[],a=kt(),a!==s)for(;a!==s;)r.push(a),a=kt();else r=n;return r!==s&&(P=e,r=Ot(r)),e=r,p[i]={nextPos:t,result:e},e}function Be(){var e,r,a=t*49+11,i=p[a];return i?(t=i.nextPos,i.result):(e=t,r=mt(),r!==s&&(P=e,r=qe(r)),e=r,e===s&&(e=t,r=vt(),r!==s&&(P=e,r=qe(r)),e=r),p[a]={nextPos:t,result:e},e)}function ne(){var e,r=t*49+12,a=p[r];return a?(t=a.nextPos,a.result):(e=Zs(),e===s&&(e=ir(),e===s&&(e=Xs(),e===s&&(e=Qs(),e===s&&(e=er(),e===s&&(e=tr(),e===s&&(e=sr())))))),p[r]={nextPos:t,result:e},e)}function Zs(){var e,r=t*49+13,a=p[r];return a?(t=a.nextPos,a.result):(e=Ys(),e===s&&(e=mt(),e===s&&(e=Ws(),e===s&&(e=vt()))),p[r]={nextPos:t,result:e},e)}function Ys(){var e,r,a,i,o,f=t*49+14,h=p[f];if(h)return t=h.nextPos,h.result;if(e=t,l.substr(t,3)===ae?(r=ae,t+=3):(r=s,d===0&&m(Ce)),r!==s)if(a=G(),a===s&&(a=re),a!==s){for(i=[],o=Pt();o!==s;)i.push(o),o=Pt();i!==s?(l.substr(t,3)===ae?(o=ae,t+=3):(o=s,d===0&&m(Ce)),o!==s?(P=e,r=ge(i),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;else t=e,e=n;return p[f]={nextPos:t,result:e},e}function mt(){var e,r,a,i,o=t*49+15,f=p[o];if(f)return t=f.nextPos,f.result;if(e=t,l.charCodeAt(t)===34?(r=xe,t++):(r=s,d===0&&m(be)),r!==s){for(a=[],i=yt();i!==s;)a.push(i),i=yt();a!==s?(l.charCodeAt(t)===34?(i=xe,t++):(i=s,d===0&&m(be)),i!==s?(P=e,r=ge(a),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;return p[o]={nextPos:t,result:e},e}function Ws(){var e,r,a,i,o,f=t*49+16,h=p[f];if(h)return t=h.nextPos,h.result;if(e=t,l.substr(t,3)===ie?(r=ie,t+=3):(r=s,d===0&&m(Ae)),r!==s)if(a=G(),a===s&&(a=re),a!==s){for(i=[],o=Ct();o!==s;)i.push(o),o=Ct();i!==s?(l.substr(t,3)===ie?(o=ie,t+=3):(o=s,d===0&&m(Ae)),o!==s?(P=e,r=ge(i),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;else t=e,e=n;return p[f]={nextPos:t,result:e},e}function vt(){var e,r,a,i,o=t*49+17,f=p[o];if(f)return t=f.nextPos,f.result;if(e=t,l.charCodeAt(t)===39?(r=we,t++):(r=s,d===0&&m(Ee)),r!==s){for(a=[],i=$t();i!==s;)a.push(i),i=$t();a!==s?(l.charCodeAt(t)===39?(i=we,t++):(i=s,d===0&&m(Ee)),i!==s?(P=e,r=ge(a),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;return p[o]={nextPos:t,result:e},e}function yt(){var e,r,a,i=t*49+18,o=p[i];return o?(t=o.nextPos,o.result):(e=St(),e===s&&(e=t,r=t,d++,l.charCodeAt(t)===34?(a=xe,t++):(a=s,d===0&&m(be)),d--,a===s?r=O:(t=r,r=n),r!==s?(l.length>t?(a=l.charAt(t),t++):(a=s,d===0&&m(U)),a!==s?(P=e,r=_e(a),e=r):(t=e,e=n)):(t=e,e=n)),p[i]={nextPos:t,result:e},e)}function $t(){var e,r,a,i=t*49+19,o=p[i];return o?(t=o.nextPos,o.result):(e=t,r=t,d++,l.charCodeAt(t)===39?(a=we,t++):(a=s,d===0&&m(Ee)),d--,a===s?r=O:(t=r,r=n),r!==s?(l.length>t?(a=l.charAt(t),t++):(a=s,d===0&&m(U)),a!==s?(P=e,r=_e(a),e=r):(t=e,e=n)):(t=e,e=n),p[i]={nextPos:t,result:e},e)}function Pt(){var e,r,a,i=t*49+20,o=p[i];return o?(t=o.nextPos,o.result):(e=St(),e===s&&(e=Gs(),e===s&&(e=t,r=t,d++,l.substr(t,3)===ae?(a=ae,t+=3):(a=s,d===0&&m(Ce)),d--,a===s?r=O:(t=r,r=n),r!==s?(l.length>t?(a=l.charAt(t),t++):(a=s,d===0&&m(U)),a!==s?(P=e,r=Dt(a),e=r):(t=e,e=n)):(t=e,e=n))),p[i]={nextPos:t,result:e},e)}function Gs(){var e,r,a,i,o,f=t*49+21,h=p[f];if(h)return t=h.nextPos,h.result;if(e=t,l.charCodeAt(t)===92?(r=Ft,t++):(r=s,d===0&&m(It)),r!==s)if(a=G(),a!==s){for(i=[],o=_t();o!==s;)i.push(o),o=_t();i!==s?(P=e,r=Rt(),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n;return p[f]={nextPos:t,result:e},e}function Ct(){var e,r,a,i=t*49+22,o=p[i];return o?(t=o.nextPos,o.result):(e=t,r=t,d++,l.substr(t,3)===ie?(a=ie,t+=3):(a=s,d===0&&m(Ae)),d--,a===s?r=O:(t=r,r=n),r!==s?(l.length>t?(a=l.charAt(t),t++):(a=s,d===0&&m(U)),a!==s?(P=e,r=_e(a),e=r):(t=e,e=n)):(t=e,e=n),p[i]={nextPos:t,result:e},e)}function Xs(){var e,r,a,i,o=t*49+23,f=p[o];return f?(t=f.nextPos,f.result):(e=t,r=xt(),r===s&&(r=Le()),r!==s?(l.charCodeAt(t)===101?(a=qt,t++):(a=s,d===0&&m(zt)),a===s&&(l.charCodeAt(t)===69?(a=jt,t++):(a=s,d===0&&m(Ut))),a!==s?(i=Le(),i!==s?(P=e,r=Kt(r,i),e=r):(t=e,e=n)):(t=e,e=n)):(t=e,e=n),e===s&&(e=t,r=xt(),r!==s&&(P=e,r=Ht(r)),e=r),p[o]={nextPos:t,result:e},e)}function xt(){var e,r,a,i,o,f,h=t*49+24,v=p[h];return v?(t=v.nextPos,v.result):(e=t,l.charCodeAt(t)===43?(r=ke,t++):(r=s,d===0&&m(Se)),r===s&&(r=re),r!==s?(a=t,i=pe(),i!==s?(l.charCodeAt(t)===46?(o=H,t++):(o=s,d===0&&m(D)),o!==s?(f=pe(),f!==s?(i=[i,o,f],a=i):(t=a,a=n)):(t=a,a=n)):(t=a,a=n),a!==s?(P=e,r=ze(a),e=r):(t=e,e=n)):(t=e,e=n),e===s&&(e=t,l.charCodeAt(t)===45?(r=oe,t++):(r=s,d===0&&m(ce)),r!==s?(a=t,i=pe(),i!==s?(l.charCodeAt(t)===46?(o=H,t++):(o=s,d===0&&m(D)),o!==s?(f=pe(),f!==s?(i=[i,o,f],a=i):(t=a,a=n)):(t=a,a=n)):(t=a,a=n),a!==s?(P=e,r=je(a),e=r):(t=e,e=n)):(t=e,e=n)),p[h]={nextPos:t,result:e},e)}function Qs(){var e,r,a=t*49+25,i=p[a];return i?(t=i.nextPos,i.result):(e=t,r=Le(),r!==s&&(P=e,r=Jt(r)),e=r,p[a]={nextPos:t,result:e},e)}function Le(){var e,r,a,i,o,f=t*49+26,h=p[f];if(h)return t=h.nextPos,h.result;if(e=t,l.charCodeAt(t)===43?(r=ke,t++):(r=s,d===0&&m(Se)),r===s&&(r=re),r!==s){if(a=[],i=M(),i!==s)for(;i!==s;)a.push(i),i=M();else a=n;a!==s?(i=t,d++,l.charCodeAt(t)===46?(o=H,t++):(o=s,d===0&&m(D)),d--,o===s?i=O:(t=i,i=n),i!==s?(P=e,r=ze(a),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;if(e===s)if(e=t,l.charCodeAt(t)===45?(r=oe,t++):(r=s,d===0&&m(ce)),r!==s){if(a=[],i=M(),i!==s)for(;i!==s;)a.push(i),i=M();else a=n;a!==s?(i=t,d++,l.charCodeAt(t)===46?(o=H,t++):(o=s,d===0&&m(D)),d--,o===s?i=O:(t=i,i=n),i!==s?(P=e,r=je(a),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;return p[f]={nextPos:t,result:e},e}function er(){var e,r,a=t*49+27,i=p[a];return i?(t=i.nextPos,i.result):(e=t,l.substr(t,4)===Ue?(r=Ue,t+=4):(r=s,d===0&&m(Zt)),r!==s&&(P=e,r=Yt()),e=r,e===s&&(e=t,l.substr(t,5)===Ke?(r=Ke,t+=5):(r=s,d===0&&m(Wt)),r!==s&&(P=e,r=Gt()),e=r),p[a]={nextPos:t,result:e},e)}function tr(){var e,r,a,i,o,f=t*49+28,h=p[f];if(h)return t=h.nextPos,h.result;if(e=t,l.charCodeAt(t)===91?(r=j,t++):(r=s,d===0&&m(Y)),r!==s){for(a=[],i=W();i!==s;)a.push(i),i=W();a!==s?(l.charCodeAt(t)===93?(i=K,t++):(i=s,d===0&&m(x)),i!==s?(P=e,r=Xt(),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;if(e===s&&(e=t,l.charCodeAt(t)===91?(r=j,t++):(r=s,d===0&&m(Y)),r!==s?(a=bt(),a===s&&(a=re),a!==s?(l.charCodeAt(t)===93?(i=K,t++):(i=s,d===0&&m(x)),i!==s?(P=e,r=Qt(a),e=r):(t=e,e=n)):(t=e,e=n)):(t=e,e=n),e===s)){if(e=t,l.charCodeAt(t)===91?(r=j,t++):(r=s,d===0&&m(Y)),r!==s){if(a=[],i=$e(),i!==s)for(;i!==s;)a.push(i),i=$e();else a=n;a!==s?(l.charCodeAt(t)===93?(i=K,t++):(i=s,d===0&&m(x)),i!==s?(P=e,r=es(a),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;if(e===s)if(e=t,l.charCodeAt(t)===91?(r=j,t++):(r=s,d===0&&m(Y)),r!==s){if(a=[],i=$e(),i!==s)for(;i!==s;)a.push(i),i=$e();else a=n;a!==s?(i=bt(),i!==s?(l.charCodeAt(t)===93?(o=K,t++):(o=s,d===0&&m(x)),o!==s?(P=e,r=ts(a,i),e=r):(t=e,e=n)):(t=e,e=n)):(t=e,e=n)}else t=e,e=n}return p[f]={nextPos:t,result:e},e}function bt(){var e,r,a,i,o,f=t*49+29,h=p[f];if(h)return t=h.nextPos,h.result;for(e=t,r=[],a=W();a!==s;)r.push(a),a=W();if(r!==s)if(a=ne(),a!==s){for(i=[],o=W();o!==s;)i.push(o),o=W();i!==s?(P=e,r=He(a),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n;return p[f]={nextPos:t,result:e},e}function $e(){var e,r,a,i,o,f,h,v=t*49+30,b=p[v];if(b)return t=b.nextPos,b.result;for(e=t,r=[],a=W();a!==s;)r.push(a),a=W();if(r!==s)if(a=ne(),a!==s){for(i=[],o=W();o!==s;)i.push(o),o=W();if(i!==s)if(l.charCodeAt(t)===44?(o=Je,t++):(o=s,d===0&&m(Ze)),o!==s){for(f=[],h=W();h!==s;)f.push(h),h=W();f!==s?(P=e,r=He(a),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n;return p[v]={nextPos:t,result:e},e}function W(){var e,r=t*49+31,a=p[r];return a?(t=a.nextPos,a.result):(e=y(),e===s&&(e=G(),e===s&&(e=ye())),p[r]={nextPos:t,result:e},e)}function sr(){var e,r,a,i,o,f,h=t*49+32,v=p[h];if(v)return t=v.nextPos,v.result;if(e=t,l.charCodeAt(t)===123?(r=ss,t++):(r=s,d===0&&m(rs)),r!==s){for(a=[],i=y();i!==s;)a.push(i),i=y();if(a!==s){for(i=[],o=At();o!==s;)i.push(o),o=At();if(i!==s){for(o=[],f=y();f!==s;)o.push(f),f=y();o!==s?(l.charCodeAt(t)===125?(f=as,t++):(f=s,d===0&&m(is)),f!==s?(P=e,r=ns(i),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n}else t=e,e=n}else t=e,e=n;return p[h]={nextPos:t,result:e},e}function At(){var e,r,a,i,o,f,h,v,b,N,S,L=t*49+33,V=p[L];if(V)return t=V.nextPos,V.result;for(e=t,r=[],a=y();a!==s;)r.push(a),a=y();if(r!==s)if(a=de(),a!==s){for(i=[],o=y();o!==s;)i.push(o),o=y();if(i!==s)if(l.charCodeAt(t)===61?(o=ee,t++):(o=s,d===0&&m(te)),o!==s){for(f=[],h=y();h!==s;)f.push(h),h=y();if(f!==s)if(h=ne(),h!==s){for(v=[],b=y();b!==s;)v.push(b),b=y();if(v!==s)if(l.charCodeAt(t)===44?(b=Je,t++):(b=s,d===0&&m(Ze)),b!==s){for(N=[],S=y();S!==s;)N.push(S),S=y();N!==s?(P=e,r=Ye(a,h),e=r):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n;if(e===s){for(e=t,r=[],a=y();a!==s;)r.push(a),a=y();if(r!==s)if(a=de(),a!==s){for(i=[],o=y();o!==s;)i.push(o),o=y();if(i!==s)if(l.charCodeAt(t)===61?(o=ee,t++):(o=s,d===0&&m(te)),o!==s){for(f=[],h=y();h!==s;)f.push(h),h=y();f!==s?(h=ne(),h!==s?(P=e,r=Ye(a,h),e=r):(t=e,e=n)):(t=e,e=n)}else t=e,e=n;else t=e,e=n}else t=e,e=n;else t=e,e=n}return p[L]={nextPos:t,result:e},e}function wt(){var e,r,a,i=t*49+34,o=p[i];return o?(t=o.nextPos,o.result):(e=t,l.charCodeAt(t)===46?(r=H,t++):(r=s,d===0&&m(D)),r!==s?(a=pe(),a!==s?(P=e,r=ls(a),e=r):(t=e,e=n)):(t=e,e=n),p[i]={nextPos:t,result:e},e)}function Et(){var e,r,a,i,o,f,h,v,b,N,S,L,V=t*49+35,J=p[V];return J?(t=J.nextPos,J.result):(e=t,r=t,a=M(),a!==s?(i=M(),i!==s?(o=M(),o!==s?(f=M(),f!==s?(l.charCodeAt(t)===45?(h=oe,t++):(h=s,d===0&&m(ce)),h!==s?(v=M(),v!==s?(b=M(),b!==s?(l.charCodeAt(t)===45?(N=oe,t++):(N=s,d===0&&m(ce)),N!==s?(S=M(),S!==s?(L=M(),L!==s?(a=[a,i,o,f,h,v,b,N,S,L],r=a):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n),r!==s&&(P=e,r=os(r)),e=r,p[V]={nextPos:t,result:e},e)}function rr(){var e,r,a,i,o,f,h,v,b,N,S,L=t*49+36,V=p[L];return V?(t=V.nextPos,V.result):(e=t,r=t,a=M(),a!==s?(i=M(),i!==s?(l.charCodeAt(t)===58?(o=ue,t++):(o=s,d===0&&m(fe)),o!==s?(f=M(),f!==s?(h=M(),h!==s?(l.charCodeAt(t)===58?(v=ue,t++):(v=s,d===0&&m(fe)),v!==s?(b=M(),b!==s?(N=M(),N!==s?(S=wt(),S===s&&(S=re),S!==s?(a=[a,i,o,f,h,v,b,N,S],r=a):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n),r!==s&&(P=e,r=We(r)),e=r,p[L]={nextPos:t,result:e},e)}function ar(){var e,r,a,i,o,f,h,v,b,N,S,L,V,J,le,se,Z,Nt=t*49+37,Oe=p[Nt];return Oe?(t=Oe.nextPos,Oe.result):(e=t,r=t,a=M(),a!==s?(i=M(),i!==s?(l.charCodeAt(t)===58?(o=ue,t++):(o=s,d===0&&m(fe)),o!==s?(f=M(),f!==s?(h=M(),h!==s?(l.charCodeAt(t)===58?(v=ue,t++):(v=s,d===0&&m(fe)),v!==s?(b=M(),b!==s?(N=M(),N!==s?(S=wt(),S===s&&(S=re),S!==s?(l.charCodeAt(t)===45?(L=oe,t++):(L=s,d===0&&m(ce)),L===s&&(l.charCodeAt(t)===43?(L=ke,t++):(L=s,d===0&&m(Se))),L!==s?(V=M(),V!==s?(J=M(),J!==s?(l.charCodeAt(t)===58?(le=ue,t++):(le=s,d===0&&m(fe)),le!==s?(se=M(),se!==s?(Z=M(),Z!==s?(a=[a,i,o,f,h,v,b,N,S,L,V,J,le,se,Z],r=a):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n)):(t=r,r=n),r!==s&&(P=e,r=We(r)),e=r,p[Nt]={nextPos:t,result:e},e)}function ir(){var e,r,a,i,o,f=t*49+38,h=p[f];return h?(t=h.nextPos,h.result):(e=t,r=Et(),r!==s?(l.charCodeAt(t)===84?(a=Ge,t++):(a=s,d===0&&m(Xe)),a!==s?(i=rr(),i!==s?(l.charCodeAt(t)===90?(o=cs,t++):(o=s,d===0&&m(us)),o!==s?(P=e,r=fs(r,i),e=r):(t=e,e=n)):(t=e,e=n)):(t=e,e=n)):(t=e,e=n),e===s&&(e=t,r=Et(),r!==s?(l.charCodeAt(t)===84?(a=Ge,t++):(a=s,d===0&&m(Xe)),a!==s?(i=ar(),i!==s?(P=e,r=hs(r,i),e=r):(t=e,e=n)):(t=e,e=n)):(t=e,e=n)),p[f]={nextPos:t,result:e},e)}function y(){var e,r=t*49+39,a=p[r];return a?(t=a.nextPos,a.result):(ds.test(l.charAt(t))?(e=l.charAt(t),t++):(e=s,d===0&&m(ps)),p[r]={nextPos:t,result:e},e)}function G(){var e,r,a,i=t*49+40,o=p[i];return o?(t=o.nextPos,o.result):(l.charCodeAt(t)===10?(e=Qe,t++):(e=s,d===0&&m(et)),e===s&&(e=t,l.charCodeAt(t)===13?(r=gs,t++):(r=s,d===0&&m(ms)),r!==s?(l.charCodeAt(t)===10?(a=Qe,t++):(a=s,d===0&&m(et)),a!==s?(r=[r,a],e=r):(t=e,e=n)):(t=e,e=n)),p[i]={nextPos:t,result:e},e)}function _t(){var e,r=t*49+41,a=p[r];return a?(t=a.nextPos,a.result):(e=G(),e===s&&(e=y()),p[r]={nextPos:t,result:e},e)}function Pe(){var e,r,a=t*49+42,i=p[a];return i?(t=i.nextPos,i.result):(e=t,d++,l.length>t?(r=l.charAt(t),t++):(r=s,d===0&&m(U)),d--,r===s?e=O:(t=e,e=n),p[a]={nextPos:t,result:e},e)}function X(){var e,r=t*49+43,a=p[r];return a?(t=a.nextPos,a.result):(vs.test(l.charAt(t))?(e=l.charAt(t),t++):(e=s,d===0&&m(ys)),p[r]={nextPos:t,result:e},e)}function M(){var e,r,a=t*49+44,i=p[a];return i?(t=i.nextPos,i.result):($s.test(l.charAt(t))?(e=l.charAt(t),t++):(e=s,d===0&&m(Ps)),e===s&&(e=t,l.charCodeAt(t)===95?(r=Cs,t++):(r=s,d===0&&m(xs)),r!==s&&(P=e,r=bs()),e=r),p[a]={nextPos:t,result:e},e)}function kt(){var e,r=t*49+45,a=p[r];return a?(t=a.nextPos,a.result):(As.test(l.charAt(t))?(e=l.charAt(t),t++):(e=s,d===0&&m(ws)),p[r]={nextPos:t,result:e},e)}function pe(){var e,r,a,i=t*49+46,o=p[i];if(o)return t=o.nextPos,o.result;if(e=t,r=[],a=M(),a!==s)for(;a!==s;)r.push(a),a=M();else r=n;return r!==s&&(P=e,r=Es(r)),e=r,p[i]={nextPos:t,result:e},e}function St(){var e,r,a=t*49+47,i=p[a];return i?(t=i.nextPos,i.result):(e=t,l.substr(t,2)===tt?(r=tt,t+=2):(r=s,d===0&&m(_s)),r!==s&&(P=e,r=ks()),e=r,e===s&&(e=t,l.substr(t,2)===st?(r=st,t+=2):(r=s,d===0&&m(Ss)),r!==s&&(P=e,r=Ms()),e=r,e===s&&(e=t,l.substr(t,2)===rt?(r=rt,t+=2):(r=s,d===0&&m(Ns)),r!==s&&(P=e,r=Ts()),e=r,e===s&&(e=t,l.substr(t,2)===at?(r=at,t+=2):(r=s,d===0&&m(Bs)),r!==s&&(P=e,r=Ls()),e=r,e===s&&(e=t,l.substr(t,2)===it?(r=it,t+=2):(r=s,d===0&&m(Vs)),r!==s&&(P=e,r=Os()),e=r,e===s&&(e=t,l.substr(t,2)===nt?(r=nt,t+=2):(r=s,d===0&&m(Ds)),r!==s&&(P=e,r=Fs()),e=r,e===s&&(e=t,l.substr(t,2)===lt?(r=lt,t+=2):(r=s,d===0&&m(Is)),r!==s&&(P=e,r=Rs()),e=r,e===s&&(e=nr()))))))),p[a]={nextPos:t,result:e},e)}function nr(){var e,r,a,i,o,f,h,v,b,N,S,L=t*49+48,V=p[L];return V?(t=V.nextPos,V.result):(e=t,l.substr(t,2)===ot?(r=ot,t+=2):(r=s,d===0&&m(qs)),r!==s?(a=t,i=X(),i!==s?(o=X(),o!==s?(f=X(),f!==s?(h=X(),h!==s?(v=X(),v!==s?(b=X(),b!==s?(N=X(),N!==s?(S=X(),S!==s?(i=[i,o,f,h,v,b,N,S],a=i):(t=a,a=n)):(t=a,a=n)):(t=a,a=n)):(t=a,a=n)):(t=a,a=n)):(t=a,a=n)):(t=a,a=n)):(t=a,a=n),a!==s?(P=e,r=ct(a),e=r):(t=e,e=n)):(t=e,e=n),e===s&&(e=t,l.substr(t,2)===ut?(r=ut,t+=2):(r=s,d===0&&m(zs)),r!==s?(a=t,i=X(),i!==s?(o=X(),o!==s?(f=X(),f!==s?(h=X(),h!==s?(i=[i,o,f,h],a=i):(t=a,a=n)):(t=a,a=n)):(t=a,a=n)):(t=a,a=n),a!==s?(P=e,r=ct(a),e=r):(t=e,e=n)):(t=e,e=n)),p[L]={nextPos:t,result:e},e)}var Mt=[];function lr(e,r,a){var i=new Error(e);throw i.line=r,i.column=a,i}function Ve(e){Mt.push(e)}function q(e,r,a,i,o){var f={type:e,value:r,line:a(),column:i()};return o&&(f.key=o),f}function or(e,r,a){var i=parseInt("0x"+e);if(!isFinite(i)||Math.floor(i)!=i||i<0||i>1114111||i>55295&&i<57344)lr("Invalid Unicode escape code: "+e,r,a);else return cr(i)}function cr(){var e=16384,r=[],a,i,o=-1,f=arguments.length;if(!f)return"";for(var h="";++o<f;){var v=Number(arguments[o]);v<=65535?r.push(v):(v-=65536,a=(v>>10)+55296,i=v%1024+56320,r.push(a,i)),(o+1==f||r.length>e)&&(h+=String.fromCharCode.apply(null,r),r.length=0)}return h}if(ve=$(),ve!==s&&t===l.length)return ve;throw ve!==s&&t<l.length&&m({type:"end",description:"end of input"}),js(null,Ne,me)}return{SyntaxError:c,parse:u}}();function gr(E){var c=[],u=[],l="",g=Object.create(null),s=g;return C(E);function C(x){for(var A,k=0;k<x.length;k++)switch(A=x[k],A.type){case"Assign":w(A);break;case"ObjectPath":O(A);break;case"ArrayPath":U(A);break}return g}function $(x,A,k){var _=new Error(x);throw _.line=A,_.column=k,_}function w(x){var A=x.key,k=x.value,_=x.line,Q=x.column,F;l?F=l+"."+A:F=A,typeof s[A]<"u"&&$("Cannot redefine existing key '"+F+"'.",_,Q),s[A]=B(k),n(F)||(c.push(F),u.push(F))}function n(x){return c.indexOf(x)!==-1}function B(x){return x.type==="Array"?Y(x.value):x.type==="InlineTable"?z(x.value):x.value}function z(x){for(var A=Object.create(null),k=0;k<x.length;k++){var _=x[k];_.value.type==="InlineTable"?A[_.key]=z(_.value.value):_.type==="InlineTableValue"&&(A[_.key]=B(_.value))}return A}function O(x){var A=x.value,k=A.map(K).join("."),_=x.line,Q=x.column;n(k)&&$("Cannot redefine existing key '"+A+"'.",_,Q),c.push(k),s=j(g,A,Object.create(null),_,Q),l=A}function U(x){var A=x.value,k=A.map(K).join("."),_=x.line,Q=x.column;if(n(k)||c.push(k),c=c.filter(function(H){return H.indexOf(k)!==0}),c.push(k),s=j(g,A,[],_,Q),l=k,s instanceof Array){var F=Object.create(null);s.push(F),s=F}else $("Cannot redefine existing key '"+A+"'.",_,Q)}function j(x,A,k,_,Q){var F=[],H="";A.join(".");for(var D=x,ee=0;ee<A.length;ee++){var te=A[ee];F.push(te),H=F.join("."),typeof D[te]>"u"?ee===A.length-1?D[te]=k:D[te]=Object.create(null):ee!==A.length-1&&u.indexOf(H)>-1&&$("Cannot redefine existing key '"+H+"'.",_,Q),D=D[te],D instanceof Array&&D.length&&ee<A.length-1&&(D=D[D.length-1])}return D}function Y(x){for(var A=null,k=0;k<x.length;k++){var _=x[k];A===null?A=_.type:_.type!==A&&$("Cannot add value of type "+_.type+" to array of type "+A+".",_.line,_.column)}return x.map(B)}function K(x){return x.indexOf(".")>-1?'"'+x+'"':x}}var mr={compile:gr},vr=pr,yr=mr,$r={parse:function(E){var c=vr.parse(E.toString());return yr.compile(c)}};const Pr=dr($r);class Tt{constructor(c){T(this,"raw");T(this,"tree");this.raw=c;try{this.tree=Pr.parse(c)||{}}catch(u){console.error("TOML parse error",u),this.tree={}}}getRaw(){return this.raw}listVps(){const c=this.tree.aff??{},u=this.tree.url??{},l=this.tree.vps??{},g=[];return Object.entries(l).forEach(([s,C])=>{Object.entries(C).forEach(([$,w])=>{var U,j;const n=w.pid||$,B=((U=u[s])==null?void 0:U.sale_format)??"",z=((j=u[s])==null?void 0:j.valid_format)??"",O=this.resolveAffCode(c[s]);g.push({vendor:s,pid:n,humanComment:w.human_comment||"",saleUrl:this.fillTemplate(B,O,n),validUrl:this.fillTemplate(z,O,n)})})}),g}getIntervalSeconds(c){var l,g;const u=(g=(l=this.tree.url)==null?void 0:l[c])==null?void 0:g.valid_interval_time;return u?Number(u):86400}getDelayRange(c){var $,w;const u=((w=($=this.tree.url)==null?void 0:$[c])==null?void 0:w.valid_vps_time)??"5-10";if(!u.includes("-")){const n=Math.max(1,Number(u));return{min:n,max:n}}const[l,g]=u.split("-"),s=Math.max(1,Number(l)),C=Math.max(s,Number(g));return{min:s,max:C}}resolveAffCode(c){return c?c.code??Object.values(c).join(""):""}fillTemplate(c,u,l){return c?c.replace("{aff}",encodeURIComponent(u)).replace("{pid}",encodeURIComponent(l)):""}}class Bt{constructor(c,u){T(this,"element");this.element=document.createElement("div"),this.element.className="asv-modal hidden";const l=document.createElement("div");l.className="asv-modal__body";const g=document.createElement("header");g.className="asv-modal__header",g.innerHTML=`<h3>${c}</h3>`;const s=document.createElement("button");s.className="asv-modal__close",s.type="button",s.textContent="Ã—",s.dataset.logLabel=`å…³é—­ ${c}`,s.addEventListener("click",()=>this.hide()),g.appendChild(s),l.appendChild(g),l.appendChild(u),this.element.appendChild(l)}mount(c){c.appendChild(this.element)}show(){this.element.classList.remove("hidden")}hide(){this.element.classList.add("hidden")}getNode(){return this.element}}class Cr{constructor(c,u){T(this,"node");T(this,"timezone");this.node=c,this.timezone=u}setTimezone(c){this.timezone=c}push(c,u="info"){const l=this.formatTime(),g=document.createElement("div");g.className=`asv-log-row asv-log-${u}`,g.textContent=`[${l}] ${c}`,this.node.prepend(g)}clear(){this.node.innerHTML=""}formatTime(){try{return new Date().toLocaleString("zh-CN",{timeZone:this.timezone,hour12:!1})}catch(c){return console.warn("timezone fallback",c),new Date().toLocaleString()}}}const xr="ç­‰å¾…æŠ“å– VPS è¯¦æƒ…ï¼Œä¿å­˜é…ç½®å¹¶éªŒè¯åè‡ªåŠ¨å¡«å……ã€‚";function br(E,c){const u=(E||"").trim();return u.length?u:c.length?c.join(`
`):xr}function De(E){switch(E){case"manual":return"å½“å‰ä¸ºç®¡ç†å‘˜æ‰‹åŠ¨æ•´ç†å†…å®¹";case"ai":return"å·²ç”± AI æ•´ç†å±•ç¤ºä¿¡æ¯";case"raw":default:return"åŸºäºæŠ“å–ç»“æœè‡ªåŠ¨å¡«å……"}}const Ar=`[aff]
[aff.rn]
4886

[url]
[url.rn]
sale_format = 'https://my.racknerd.com/aff.php?aff={aff}&pid={pid}'
valid_format = 'https://my.racknerd.com/cart.php?a=add&pid={pid}'
valid_interval_time = '172800'
valid_vps_time = '5-10'

[vps]
[vps.rn.923]
pid = '923'
human_comment = 'éå¸¸åŸºç¡€çš„ä¸€æ¬¾VPSï¼Œä½†æ˜¯å®¹é‡ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ã€‚'

[vps.rn.924]
pid = '924'
human_comment = ''

[vps.rn.925]
pid = '925'
human_comment = ''

[vps.rn.926]
pid = '926'
human_comment = ''

[vps.rn.927]
pid = '927'
human_comment = ''`,wr=`[model_providers]
[model_providers.omg]
base_url = 'https://api.ohmygpt.com/v1'
model = 'gpt-4.1-mini'
prompt_valid = '''
ä½ æ˜¯ AutoSaleVPS çš„å¯å–æ€§å®¡æ ¸åŠ©æ‰‹ã€‚ä½ å°†æ”¶åˆ°ä¸€ä¸ª JSONï¼Œå…¶ä¸­åŒ…å«ï¼š
- vendor / pid / valid_urlï¼›
- HTTP statusã€ç²¾é€‰å“åº”å¤´ã€æ­£æ–‡æ‘˜è¦ã€HTML æˆªæ–­ç‰‡æ®µï¼›
- initial_state / initial_reasonï¼ˆå¯å‘å¼ç»“è®ºï¼‰ä»¥åŠ signalsï¼ˆå…³é”®å­—å‘½ä¸­åˆ—è¡¨ï¼‰ã€‚

è¯·ç»“åˆæ‰€æœ‰å­—æ®µï¼ˆå°¤å…¶æ˜¯ signals ä¸æ­£æ–‡è¯­ä¹‰ï¼‰åˆ¤æ–­è¯¥ VPS æ˜¯å¦è¿˜å¯ä¸‹å•ï¼Œè‹¥ä¿¡æ¯ä¸è¶³å¯è¿”å› unknownã€‚
è¾“å‡ºè¦æ±‚ï¼š
- å¿…é¡»æ˜¯å•ä¸ª JSON å¯¹è±¡ï¼Œä¸èƒ½å¸¦é¢å¤–æ–‡å­—ã€‚
- å­—æ®µï¼šstatus(online/offline/unknown)ã€reason(<=120å­—ï¼Œæ¦‚è¿°è¯æ®)ã€confidence(0~1 å¯é€‰)ï¼Œå¯æ‰©å±• evidence æ•°ç»„åˆ—å‡ºå…³é”®çº¿ç´¢ã€‚
- è‹¥æ£€æµ‹åˆ°â€œsold outâ€â€œout of stockâ€ç­‰è´Ÿé¢ä¿¡å·ï¼Œç›´æ¥åˆ¤å®š offlineï¼›è‹¥èƒ½ç¡®è®¤æœ‰è´­å…¥æŒ‰é’®/åº“å­˜æç¤ºå†åˆ¤å®š onlineã€‚

ä¸¥æ ¼éµå®ˆ JSON è¾“å‡ºæ ¼å¼ï¼Œé¿å…è‡ªç„¶è¯­è¨€æè¿°ã€‚
'''
prompt_vps_info = 'åŸºäºè¾“å…¥ç»™å‡ºä¸€æ®µæ¨é”€VPSçš„å¹¿å‘Šï¼Œå­—æ•°é™å®šåœ¨40å­—å·¦å³ã€‚æ¨å¹¿è¦æ±‚è´´åˆVPSçš„å®é™…ï¼Œä¸èƒ½æ— è„‘æ¨ã€‚ä»å»ºç«‹åšå®¢ã€AIã€RSSã€Dockerç­‰4ä¸ªåº”ç”¨åœºæ™¯è¯„ä¼°VPSçš„æ¨èæ€§ã€‚ä¸è¦æ·»åŠ æ¨å¹¿é“¾æ¥ï¼Œæˆ‘å·²ç»åœ¨å…¶å®ƒåœ°æ–¹å±•ç¤ºæ¨å¹¿é“¾æ¥ã€‚'
prompt_meta_layout = 'è¯·å°†è¾“å…¥JSONæ•´ç†æˆå›ºå®šçš„8è¡Œä¸­æ–‡ï¼Œä¾æ¬¡ä¸ºï¼šå‚å•†ã€CPUã€å†…å­˜ã€å­˜å‚¨ã€å¸¦å®½ã€ç½‘ç»œã€ä»·æ ¼ã€åœ°ç†ä½ç½®ã€‚æ¯ä¸€è¡Œå¿…é¡»ä½¿ç”¨â€œå­—æ®µï¼šå†…å®¹â€æ ¼å¼ï¼Œå­—æ®µåéœ€ä¸ä¸Šè¿°å®Œå…¨ä¸€è‡´ï¼Œå¦‚ä¿¡æ¯ç¼ºå¤±åˆ™å¡«â€œ-â€ï¼Œä¸è¦è¾“å‡ºå…¶ä»–æ–‡å­—ã€‚'`,Er=`/* é€‚é… https://blognas.hwb0307.com/ad çš„é€šé€å¸ƒå±€ */
.asv-root {
  padding: 0;
  background: transparent;
}

.asv-card {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.58), rgba(226, 239, 255, 0.32));
  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 24px;
  box-shadow: 0 35px 80px rgba(15, 23, 42, 0.25);
  backdrop-filter: blur(12px);
}

.asv-card--offline {
  border-color: rgba(239, 79, 79, 0.5);
  box-shadow: 0 35px 80px rgba(239, 79, 79, 0.4);
}

.asv-sale-btn {
  background: linear-gradient(120deg, #ff9f5a, #f05438);
  color: #fff !important;
  border: none;
  box-shadow: 0 14px 30px rgba(240, 84, 56, 0.3);
}`;class _r{constructor(c,u){T(this,"root");T(this,"rest");T(this,"logPanel");T(this,"logPanelHost");T(this,"logPanelClearButton");T(this,"bootstrap");T(this,"vpsContainer");T(this,"timezoneSelect");T(this,"configBundle");T(this,"modelBundle");T(this,"cssBundle");T(this,"keyModal");T(this,"keyInput");T(this,"hasKey");T(this,"currentConfig");T(this,"currentVps",[]);T(this,"availabilityTimer");T(this,"inFlightValidation",!1);T(this,"extraCssNode");T(this,"timezone");this.root=c,this.bootstrap=u,this.rest=new hr(u.restUrl,u.nonce),this.hasKey=u.hasKey,this.timezone=u.timezone}init(){this.applyExtraCss(this.bootstrap.extraCss||""),this.renderLayout(),this.mountLogPanel(),this.attachButtonLogs(),this.attachTimezone(),this.attachButtons(),this.loadVpsCards(!0),this.bootstrap.isAdmin&&(this.prepareModals(),this.loadConfigForEditing(),this.loadModelForEditing(),this.loadExtraCss())}mountLogPanel(){var c;this.logPanel=new Cr(this.logPanelHost,this.bootstrap.timezone),(c=this.logPanelClearButton)==null||c.addEventListener("click",()=>{this.logPanel.clear()})}renderLayout(){if(this.root.innerHTML="",this.bootstrap.isAdmin){const C=document.createElement("div");C.className="asv-toolbar";const $=document.createElement("div");$.className="asv-toolbar__row";const w=document.createElement("div");w.className="asv-actions";const n=document.createElement("div");n.className="asv-actions asv-actions--secondary";const B=this.createButton("ç¼–è¾‘VPSé…ç½®","æ‰“å¼€ config.toml ç¼–è¾‘å™¨");B.dataset.action="edit-config";const z=this.createButton("ç¼–è¾‘æ¨¡å‹é…ç½®","æ‰“å¼€ model.toml ç¼–è¾‘å™¨");z.dataset.action="edit-model";const O=this.createButton(this.hasKey?"æ›´æ–°KEY":"æ·»åŠ KEY","æ‰“å¼€ API KEY è®¾ç½®");O.dataset.action="add-key";const U=this.createButton("é¢å¤–CSS","æ‰“å¼€é¢å¤– CSS ç¼–è¾‘å™¨");U.dataset.action="edit-css";const j=this.createButton("æ£€æŸ¥å¯ç”¨æ€§","è¿è¡Œè¯Šæ–­");j.dataset.action="diagnostics";const Y=this.createButton("æŸ¥çœ‹VPSçŠ¶æ€","åˆ·æ–° VPS åˆ—è¡¨");Y.dataset.action="check-vps",w.append(B,z,O,U),n.append(j,Y);const K=document.createElement("div");K.className="asv-timezone";const x=document.createElement("label");x.textContent="æ—¶åŒº";const A=document.createElement("select");this.bootstrap.options.forEach(k=>{const _=document.createElement("option");_.value=k,_.textContent=k,k===this.bootstrap.timezone&&(_.selected=!0),A.appendChild(_)}),this.timezoneSelect=A,x.appendChild(A),K.appendChild(x),$.append(w,K),C.append($,n),this.root.appendChild(C)}const c=document.createElement("div");c.className="asv-log-panel";const u=document.createElement("div");u.className="asv-log-panel__header";const l=document.createElement("span");l.textContent="ç³»ç»Ÿæ—¥å¿—";const g=document.createElement("button");g.type="button",g.className="asv-log-panel__clear",g.textContent="æ¸…ç©ºæ—¥å¿—",g.dataset.logSkip="true",u.append(l,g);const s=document.createElement("div");s.className="asv-log-panel__body",c.append(u,s),this.logPanelHost=s,this.logPanelClearButton=g,this.root.appendChild(c),this.vpsContainer=document.createElement("div"),this.vpsContainer.className="asv-vps-list",this.root.appendChild(this.vpsContainer)}createButton(c,u){const l=document.createElement("button");return l.type="button",l.textContent=c,l.className="asv-btn",l.dataset.logLabel=u||c,l}attachButtonLogs(){this.root.addEventListener("click",c=>{if(!this.logPanel)return;const u=c.target,l=u==null?void 0:u.closest("button");if(!l||l.dataset.logSkip==="true")return;const g=(l.dataset.logLabel||l.textContent||"").trim();g&&this.logPanel.push(`æ“ä½œï¼š${g}`)},!0)}attachTimezone(){var c;(c=this.timezoneSelect)==null||c.addEventListener("change",async()=>{const u=this.timezoneSelect.value;try{await this.rest.saveTimezone(u),this.logPanel.setTimezone(u),this.timezone=u,this.updateCardTimestamps(),this.logPanel.push(`å·²åˆ‡æ¢åˆ° ${u}`)}catch(l){this.logPanel.push(`è®¾ç½®æ—¶åŒºå¤±è´¥ï¼š${l.message}`,"error")}})}attachButtons(){this.root.addEventListener("click",c=>{const u=c.target;if(u.matches("[data-action]")){if(!this.bootstrap.isAdmin){this.logPanel.push("éœ€è¦ç®¡ç†å‘˜æƒé™æ‰§è¡Œæ­¤æ“ä½œ","error");return}switch(u.dataset.action){case"edit-config":this.configBundle.modal.show();break;case"edit-model":this.modelBundle.modal.show();break;case"edit-css":this.cssBundle.modal.show();break;case"add-key":this.keyModal.show();break;case"check-vps":this.handleManualStatusCheck();break;case"diagnostics":this.runDiagnostics();break}}})}async handleManualStatusCheck(){this.bootstrap.isAdmin&&(await this.loadVpsCards(!1),this.triggerAvailabilitySweep("æ‰‹åŠ¨æŸ¥çœ‹VPSçŠ¶æ€"))}prepareModals(){this.configBundle=this.createEditorModal("ç¼–è¾‘ config.toml",Ar,async()=>{try{await this.rest.saveConfig(this.configBundle.textarea.value),this.logPanel.push("é…ç½®å·²ä¿å­˜","success"),this.currentConfig=new Tt(this.configBundle.textarea.value),this.scheduleValidation(),this.configBundle.modal.hide()}catch(s){this.logPanel.push(`ä¿å­˜å¤±è´¥ï¼š${s.message}`,"error")}},"ä¿å­˜ config.toml"),this.modelBundle=this.createEditorModal("ç¼–è¾‘ model.toml",wr,async()=>{try{await this.rest.saveModel(this.modelBundle.textarea.value),this.logPanel.push("æ¨¡å‹é…ç½®å·²ä¿å­˜","success"),this.modelBundle.modal.hide()}catch(s){this.logPanel.push(`ä¿å­˜æ¨¡å‹å¤±è´¥ï¼š${s.message}`,"error")}},"ä¿å­˜ model.toml"),this.cssBundle=this.createEditorModal("é¢å¤– CSSï¼ˆå¯é€‰ï¼‰",Er,async()=>{try{await this.rest.saveExtraCss(this.cssBundle.textarea.value),this.applyExtraCss(this.cssBundle.textarea.value),this.logPanel.push("é¢å¤– CSS å·²ä¿å­˜","success"),this.cssBundle.modal.hide()}catch(s){this.logPanel.push(`ä¿å­˜ CSS å¤±è´¥ï¼š${s.message}`,"error")}},"ä¿å­˜é¢å¤– CSS");const c=document.createElement("div");c.className="asv-modal__content";const u=document.createElement("input");u.type="password",u.placeholder="sk-xxx",u.className="asv-input",this.keyInput=u;const l=document.createElement("button");l.type="button",l.className="asv-eye",l.textContent="ğŸ‘",l.dataset.logLabel="é¢„è§ˆ API KEY",l.addEventListener("mouseenter",()=>{this.keyInput.type="text"}),l.addEventListener("mouseleave",()=>{this.keyInput.type="password"});const g=this.createButton("ä¿å­˜é…ç½®","ä¿å­˜ API KEY");g.addEventListener("click",async()=>{try{await this.rest.saveApiKey(this.keyInput.value),this.hasKey=!0,this.logPanel.push("API KEY å·²æ›´æ–°","success"),this.keyModal.hide(),this.keyInput.value=""}catch(s){this.logPanel.push(`ä¿å­˜ KEY å¤±è´¥ï¼š${s.message}`,"error")}}),c.append(u,l,g),this.keyModal=new Bt("æ·»åŠ /æ›´æ–° KEY",c),this.keyModal.mount(this.root)}createEditorModal(c,u,l,g){const s=document.createElement("div");if(s.className="asv-modal__content",u){const n=document.createElement("details");n.className="asv-helper";const B=document.createElement("summary");B.textContent="æŸ¥çœ‹é»˜è®¤ç¤ºä¾‹";const z=document.createElement("pre");z.textContent=u,n.append(B,z),s.appendChild(n)}const C=document.createElement("textarea");C.className="asv-textarea",C.rows=18;const $=this.createButton("ä¿å­˜é…ç½®",g||`ä¿å­˜ ${c}`);$.addEventListener("click",l),s.append(C,$);const w=new Bt(c,s);return w.mount(this.root),{modal:w,textarea:C,saveButton:$}}async loadConfigForEditing(){try{const{content:c}=await this.rest.fetchConfig();this.configBundle.textarea.value=c,this.currentConfig=new Tt(c),this.logPanel.push("å·²è½½å…¥ config.toml"),this.scheduleValidation()}catch(c){this.logPanel.push(`è½½å…¥ config.toml å¤±è´¥ï¼š${c.message}`,"error")}}async loadModelForEditing(){try{const{content:c}=await this.rest.fetchModel();this.modelBundle.textarea.value=c,this.logPanel.push("å·²è½½å…¥ model.toml")}catch(c){this.logPanel.push(`è½½å…¥ model.toml å¤±è´¥ï¼š${c.message}`,"error")}}async loadExtraCss(){try{const{extraCss:c}=await this.rest.fetchExtraCss();this.cssBundle.textarea.value=c,this.applyExtraCss(c),this.logPanel.push("å·²è½½å…¥é¢å¤– CSS")}catch(c){this.logPanel.push(`è½½å…¥é¢å¤– CSS å¤±è´¥ï¼š${c.message}`,"error")}}async loadVpsCards(c=!0){this.vpsContainer.innerHTML='<div class="asv-loading">æ­£åœ¨è½½å…¥VPSæ•°æ®...</div>';try{const{vps:u}=c?await this.rest.fetchCachedVps():await this.rest.fetchVps();this.currentVps=u,this.renderVpsList(u),this.bootstrap.isAdmin&&(c?this.logPanel.push("å·²è½½å…¥ç¼“å­˜çš„ VPS çŠ¶æ€ï¼Œå¦‚éœ€æ›´æ–°è¯·ç‚¹å‡»â€œæŸ¥çœ‹VPSçŠ¶æ€â€","info"):this.logPanel.push("å·²æŠ“å–æœ€æ–° VPS æ•°æ®","success"),this.scheduleValidation())}catch(u){this.vpsContainer.innerHTML='<p class="asv-error">æ— æ³•è·å–VPSä¿¡æ¯</p>',this.logPanel.push(`è·å–VPSå¤±è´¥ï¼š${u.message}`,"error")}}renderVpsList(c){if(this.vpsContainer.innerHTML="",!c.length){this.vpsContainer.innerHTML="<p>æš‚æ—  VPS è®°å½•</p>";return}c.forEach(u=>{const l=document.createElement("article");l.className="asv-card",l.dataset.key=`${u.vendor}-${u.pid}`,u.available===!1&&l.classList.add("asv-card--offline"),u.checked_at&&(l.dataset.checkedAt=`${u.checked_at}`);const g=document.createElement("div");g.className="asv-card__title";const s=document.createElement("strong");s.textContent=`${u.vendor.toUpperCase()} #${u.pid}`,g.append(s,this.createStatusPill(u)),l.appendChild(g);const C=document.createElement("a");if(C.href=u.sale_url,C.target="_blank",C.rel="noopener",C.className="asv-sale-btn",C.textContent="æ‰“å¼€æ¨å¹¿é“¾æ¥",l.appendChild(C),this.bootstrap.isAdmin)l.appendChild(this.createPromoEditor(u));else{const n=document.createElement("p");n.className="asv-card__promo",n.textContent=this.formatPromo(u),l.appendChild(n)}if(this.bootstrap.isAdmin?l.appendChild(this.createMetaEditor(u)):l.appendChild(this.createMetaViewer(u)),u.human_comment){const n=document.createElement("div");n.className="asv-card__note",n.textContent=u.human_comment,l.appendChild(n)}const $=document.createElement("footer");if($.className="asv-card__footer",this.bootstrap.isAdmin){const n=`${u.vendor.toUpperCase()}#${u.pid}`,B=this.createButton("éªŒè¯",`éªŒè¯ ${n}`);B.classList.add("asv-btn--ghost"),B.addEventListener("click",()=>this.validateSingle(u.vendor,u.pid,"æ‰‹åŠ¨éªŒè¯")),$.appendChild(B)}const w=document.createElement("div");w.className="asv-card__timestamp",w.textContent=this.formatCheckedAt(u.checked_at),$.prepend(w),l.appendChild($),this.vpsContainer.appendChild(l)})}createPromoEditor(c){const u=document.createElement("div");u.className="asv-promo-editor";const l=document.createElement("textarea");l.className="asv-promo-editor__textarea",l.value=c.promo||"",l.placeholder="è¾“å…¥è‡ªå®šä¹‰æ¨å¹¿è¯­ï¼Œ20-100 å­—ï¼Œä¿æŒçœŸå®é…ç½®ã€‚",u.appendChild(l);const g=document.createElement("div");g.className="asv-promo-actions";const s=`${c.vendor.toUpperCase()}#${c.pid}`,C=this.createButton("ä¿å­˜æ¨å¹¿è¯­",`ä¿å­˜æ¨å¹¿è¯­ ${s}`);C.classList.add("asv-btn--sm");const $=this.createButton("AI é‡å†™",`AI é‡å†™æ¨å¹¿è¯­ ${s}`);return $.classList.add("asv-btn--ghost","asv-btn--sm"),C.addEventListener("click",()=>this.persistPromoOverride(c.vendor,c.pid,l,C,$)),$.addEventListener("click",()=>this.regeneratePromo(c.vendor,c.pid,l,C,$)),g.append(C,$),u.appendChild(g),u}createMetaViewer(c){const u=document.createElement("div");u.className="asv-meta-section";const l=document.createElement("pre");return l.className="asv-meta-block",l.textContent=this.formatMetaDisplay(c),u.appendChild(l),u}createMetaEditor(c){const u=document.createElement("div");u.className="asv-meta-editor";const l=document.createElement("textarea");l.className="asv-meta-editor__textarea asv-meta-block",l.value=this.formatMetaDisplay(c),l.spellcheck=!1,u.appendChild(l);const g=document.createElement("div");g.className="asv-meta-hint",g.textContent=De(c.meta_source),u.appendChild(g);const s=document.createElement("div");s.className="asv-meta-actions";const C=`${c.vendor.toUpperCase()}#${c.pid}`,$=this.createButton("ä¿å­˜ä¿¡æ¯",`ä¿å­˜å…ƒä¿¡æ¯ ${C}`);$.classList.add("asv-btn--sm");const w=this.createButton("AI æ•´ç†",`AI æ•´ç†å…ƒä¿¡æ¯ ${C}`);return w.classList.add("asv-btn--ghost","asv-btn--sm"),$.addEventListener("click",()=>this.persistMetaOverride(c.vendor,c.pid,l,g,$,w)),w.addEventListener("click",()=>this.regenerateMeta(c.vendor,c.pid,l,g,$,w)),s.append($,w),u.appendChild(s),u}formatMetaDisplay(c){return br(c.meta_display,c.meta||[])}togglePromoButtons(c,...u){u.forEach(l=>{l.disabled=c})}toggleMetaButtons(c,...u){u.forEach(l=>{l.disabled=c})}async persistPromoOverride(c,u,l,g,s){const C=l.value.trim();if(!C){this.logPanel.push("æ¨å¹¿è¯­ä¸èƒ½ä¸ºç©º","error"),l.focus();return}this.togglePromoButtons(!0,g,s);try{const $=await this.rest.savePromo(c,u,C);l.value=$.promo||"",this.updatePromoRecord(c,u,$.promo,$.source),this.logPanel.push(`${c} ${u} æ¨å¹¿è¯­å·²ä¿å­˜`,"success")}catch($){this.logPanel.push(`ä¿å­˜æ¨å¹¿è¯­å¤±è´¥ï¼š${$.message}`,"error")}finally{this.togglePromoButtons(!1,g,s)}}async persistMetaOverride(c,u,l,g,s,C){const $=l.value.trim();if(!$){this.logPanel.push("å±•ç¤ºä¿¡æ¯ä¸èƒ½ä¸ºç©º","error"),l.focus();return}this.toggleMetaButtons(!0,s,C);try{const w=await this.rest.saveMeta(c,u,$),n=w.content||"";l.value=n,g.textContent=De(w.source),this.updateMetaRecord(c,u,n,w.source),this.logPanel.push(`${c} ${u} å…ƒä¿¡æ¯å·²ä¿å­˜`,"success")}catch(w){this.logPanel.push(`ä¿å­˜å…ƒä¿¡æ¯å¤±è´¥ï¼š${w.message}`,"error")}finally{this.toggleMetaButtons(!1,s,C)}}async regenerateMeta(c,u,l,g,s,C){this.toggleMetaButtons(!0,s,C);try{const $=await this.rest.refreshMeta(c,u),w=$.content||"";l.value=w,g.textContent=De($.source),this.updateMetaRecord(c,u,w,$.source),this.logPanel.push(`${c} ${u} å…ƒä¿¡æ¯å·²ç”± AI æ•´ç†`,"success")}catch($){this.logPanel.push(`AI æ•´ç†å¤±è´¥ï¼š${$.message}`,"error")}finally{this.toggleMetaButtons(!1,s,C)}}async regeneratePromo(c,u,l,g,s){this.togglePromoButtons(!0,g,s);try{const C=await this.rest.refreshPromo(c,u);l.value=C.promo||"",this.updatePromoRecord(c,u,C.promo,C.source),this.logPanel.push(`${c} ${u} æ¨å¹¿è¯­å·²é‡æ–°ç”Ÿæˆ`,"success")}catch(C){this.logPanel.push(`é‡æ–°ç”Ÿæˆæ¨å¹¿è¯­å¤±è´¥ï¼š${C.message}`,"error")}finally{this.togglePromoButtons(!1,g,s)}}updatePromoRecord(c,u,l,g){const s=this.currentVps.find(C=>C.vendor===c&&C.pid===u);s&&(s.promo=l,s.promo_source=g)}updateMetaRecord(c,u,l,g){const s=this.currentVps.find(C=>C.vendor===c&&C.pid===u);s&&(s.meta_display=l,s.meta_source=g)}formatPromo(c){return c.promo||"ç­‰å¾…ç”Ÿæˆæ¨å¹¿è¯æœ¯..."}createStatusPill(c){const u=document.createElement("span");return u.className="asv-status-pill",c.available===null?(u.classList.add("asv-status-pill--idle"),u.textContent="ç­‰å¾…éªŒè¯"):c.available?(u.classList.add("asv-status-pill--up"),u.textContent="åœ¨çº¿"):(u.classList.add("asv-status-pill--down"),u.textContent="å·²å”®ç½„"),u}scheduleValidation(){if(!this.bootstrap.isAdmin||!this.currentConfig)return;this.availabilityTimer&&window.clearInterval(this.availabilityTimer);const c=this.currentConfig.listVps();if(!c.length)return;const u=c.map(g=>{var s;return((s=this.currentConfig)==null?void 0:s.getIntervalSeconds(g.vendor))??86400}),l=Math.max(60,Math.min(...u));this.availabilityTimer=window.setInterval(()=>{this.triggerAvailabilitySweep("å®šæ—¶å·¡æ£€")},l*1e3)}triggerAvailabilitySweep(c){!this.bootstrap.isAdmin||this.inFlightValidation||(this.inFlightValidation=!0,this.logPanel.push(`${c}ï¼šå¼€å§‹éªŒè¯æ‰€æœ‰ VPS`),this.validateAll().catch(u=>this.logPanel.push(`æ‰¹é‡éªŒè¯å¤±è´¥ï¼š${u.message}`,"error")).finally(()=>{this.inFlightValidation=!1}))}async validateAll(){var c;for(const u of this.currentVps){await this.validateSingle(u.vendor,u.pid,"æ‰¹é‡é˜Ÿåˆ—");const l=((c=this.currentConfig)==null?void 0:c.getDelayRange(u.vendor))??{min:5,max:10},g=this.randomDelay(l.min,l.max);await this.sleep(g)}}async validateSingle(c,u,l){try{const g=await this.rest.validateVps(c,u);this.logPanel.push(`${l}ï¼š${c} ${u} -> ${g.available?"åœ¨çº¿":"å”®ç½„"} (${g.message})`),this.applyStatus(c,u,g.available,g.message,g.checked_at)}catch(g){this.logPanel.push(`éªŒè¯ ${c} ${u} å¤±è´¥ï¼š${g.message}`,"error")}}applyStatus(c,u,l,g,s){var n;const C=`${c}-${u}`,$=this.vpsContainer.querySelector(`[data-key="${C}"]`);if($){$.classList.toggle("asv-card--offline",!l);const B=$.querySelector(".asv-status-pill");B&&(B.textContent=l?"åœ¨çº¿":"å·²å”®ç½„",B.className=`asv-status-pill ${l?"asv-status-pill--up":"asv-status-pill--down"}`),(n=$.querySelector(".asv-soldout"))==null||n.remove();const z=s??Math.floor(Date.now()/1e3);z?$.dataset.checkedAt=`${z}`:delete $.dataset.checkedAt;const O=$.querySelector(".asv-card__timestamp");O&&(O.textContent=this.formatCheckedAt(z))}const w=this.currentVps.find(B=>B.vendor===c&&B.pid===u);if(w){const B=s??Math.floor(Date.now()/1e3);w.available=l,w.message=g,w.checked_at=B}}async runDiagnostics(){try{const c=await this.rest.runDiagnostics();this.renderDiagnostics(c)}catch(c){this.logPanel.push(`è¯Šæ–­å¤±è´¥ï¼š${c.message}`,"error")}}renderDiagnostics(c){this.logPanel.push(`ç½‘ç»œï¼š${c.network.ok?"æ­£å¸¸":"å¼‚å¸¸"} - ${c.network.message}`),this.logPanel.push(`LLMï¼š${c.llm.ok?"å°±ç»ª":"å¼‚å¸¸"} - ${c.llm.message}`)}applyExtraCss(c){const u=(c||"").trim();if(!u){this.extraCssNode&&(this.extraCssNode.remove(),this.extraCssNode=void 0);return}if(!this.extraCssNode){const l=document.createElement("style");l.dataset.source="asv-extra-css",document.head.appendChild(l),this.extraCssNode=l}this.extraCssNode.textContent=u}randomDelay(c,u){const l=u-c;return(c+Math.random()*l)*1e3}sleep(c){return new Promise(u=>{window.setTimeout(u,c)})}formatCheckedAt(c){if(!c)return"æœ€åæ›´æ–°æ—¶é—´ï¼š-";try{return`æœ€åæ›´æ–°æ—¶é—´ï¼š${new Date(c*1e3).toLocaleString("zh-CN",{timeZone:this.timezone,hour12:!1})}`}catch(u){return console.warn("formatCheckedAt fallback",u),`æœ€åæ›´æ–°æ—¶é—´ï¼š${new Date(c*1e3).toLocaleString()}`}}updateCardTimestamps(){this.vpsContainer.querySelectorAll(".asv-card").forEach(c=>{const u=c.dataset.checkedAt,l=c.querySelector(".asv-card__timestamp");if(!l)return;const g=u?Number(u):null;l.textContent=this.formatCheckedAt(Number.isFinite(g)?g:null)})}}let Lt=!1,Fe=null;const kr=()=>window.ASV_BOOTSTRAP?!0:(Lt||(console.warn("AutoSaleVPS: ç¼ºå°‘åˆå§‹åŒ–æ•°æ®"),Lt=!0),!1),Vt=E=>E?E.id==="asv-root"?E:E.querySelector("#asv-root"):document.getElementById("asv-root"),Ie=E=>{if(!kr())return!1;const c=Vt(E);return!c||c.dataset.asvMounted==="true"?!!c:(new _r(c,window.ASV_BOOTSTRAP).init(),c.dataset.asvMounted="true",!0)};window.AutoSaleVPSMount=Ie;const Sr=()=>{if(Fe||typeof MutationObserver>"u")return;Fe=new MutationObserver(c=>{c.forEach(u=>{u.addedNodes.forEach(l=>{if(!(l instanceof HTMLElement))return;const g=Vt(l);g&&Ie(g)})})});const E=document.body||document.documentElement;E&&Fe.observe(E,{childList:!0,subtree:!0})};Ie();Sr();
//# sourceMappingURL=main.js.map
