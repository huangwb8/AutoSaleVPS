## AutoSaleVPS 安全审查建议

### 1. LLM 配置文件可被恶意篡改
- `config.toml` 与 `model.toml` 会被复制到 `wp-content/uploads/autosalevps/`，该目录通常对站点可写。
- `ASV_Promo_Service::get_promo`、`ASV_Meta_Service::generate_display`、`ASV_Availability_Service::validate_vps` 直接读取 `model_providers.*.base_url` 并把 `Authorization: Bearer <API_KEY>` 发给该地址。
- 若攻击者能写入 uploads，可把 `base_url` 换成恶意域名窃取管理员的 LLM Key。
- **改进思路**：
  1. 优先将 TOML 配置改为存储在数据库或插件私有目录，避免暴露在可写 uploads。
  2. 至少在请求前校验 `base_url` 是否在白名单域名内，并在域名不匹配时拒绝发送密钥。
  3. 可记录基线哈希/签名，对配置文件做完整性校验，发现变化时提示管理员。

### 2. 抓取与校验 URL 缺乏约束，存在 SSRF/XXE 风险
- `config.toml` 中的 `sale_url`、`valid_url` 同样来自 uploads，可被恶意修改。
- `ASV_Availability_Service::validate_vps` 对 `valid_url` 直接 `wp_remote_get`，可被用作 SSRF。
- `ASV_Sale_Parser::extract_meta` 在 `DOMDocument::loadHTML` 前未关闭外部实体，存在 XXE 读取本地/内网文件风险。
- **改进思路**：
  1. 对所有 URL 使用 `wp_http_validate_url` 并强制匹配已知厂商域名；必要时存储 vendor→域名映射做校验。
  2. 调整 `DOMDocument`：调用 `$doc->resolveExternals = false; $doc->substituteEntities = false;`，并在 `loadHTML` 时传入 `LIBXML_NONET | LIBXML_NOERROR | LIBXML_NOWARNING`。
  3. 为 `wp_remote_get` 设置带宽/超时/响应大小限制或走受控代理，防止长连接或内部端口扫描。
  4. 结合第一点，限制上传目录的写权限或为配置引入校验流程，从源头降低被篡改概率。

> 后续建议：在代码层面完成加固后，记得跑 `npm run test` 与 `composer lint`，并同步更新部署/配置文档提醒管理员备份配置与密钥。
